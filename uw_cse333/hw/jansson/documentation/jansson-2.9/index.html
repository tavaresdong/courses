

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Jansson 2.9 documentation</title>
  

  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://jansson.readthedocs.io/en/2.8/" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> Jansson
          

          
          </a>

          
            
            
            
              <div class="version">
                2.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-gettingstarted">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-upgrading">Upgrading from 1.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-conformance">RFC Conformance</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-portability">Portability</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-apiref">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-changes">Changes in Jansson</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">Jansson</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>Jansson 2.9 documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/akheron/jansson/blob/2.9/doc/index.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="jansson-documentation">
<h1>Jansson Documentation<a class="headerlink" href="#jansson-documentation" title="Permalink to this headline">¶</a></h1>
<p>This is the documentation for <a class="reference external" href="http://www.digip.org/jansson/">Jansson</a> 2.9, last updated September 18, 2016.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.digip.org/jansson/">Jansson</a> is a C library for encoding, decoding and manipulating JSON
data. Its main features and design principles are:</p>
<ul class="simple">
<li>Simple and intuitive API and data model</li>
<li>Comprehensive documentation</li>
<li>No dependencies on other libraries</li>
<li>Full Unicode support (UTF-8)</li>
<li>Extensive test suite</li>
</ul>
<p>Jansson is licensed under the <a class="reference external" href="http://www.opensource.org/licenses/mit-license.php">MIT license</a>; see LICENSE in the
source distribution for details.</p>
<p>Jansson is used in production and its API is stable. It works on
numerous platforms, including numerous Unix like systems and Windows.
It&#8217;s suitable for use on any system, including desktop, server, and
small embedded systems.</p>
</div>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-gettingstarted"></span><div class="section" id="getting-started">
<h3>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<div class="section" id="compiling-and-installing-jansson">
<h4>Compiling and Installing Jansson<a class="headerlink" href="#compiling-and-installing-jansson" title="Permalink to this headline">¶</a></h4>
<p>The Jansson source is available at
<a class="reference external" href="http://www.digip.org/jansson/releases/">http://www.digip.org/jansson/releases/</a>.</p>
<div class="section" id="unix-like-systems-including-mingw">
<h5>Unix-like systems (including MinGW)<a class="headerlink" href="#unix-like-systems-including-mingw" title="Permalink to this headline">¶</a></h5>
<p>Unpack the source tarball and change to the source directory:</p>
<pre class="literal-block">
bunzip2 -c jansson-2.9.tar.bz2 | tar xf -
cd jansson-2.9
</pre>
<p>The source uses GNU Autotools (<a class="reference external" href="http://www.gnu.org/software/autoconf/">autoconf</a>, <a class="reference external" href="http://www.gnu.org/software/automake/">automake</a>, <a class="reference external" href="http://www.gnu.org/software/libtool/">libtool</a>), so
compiling and installing is extremely simple:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">configure</span>
<span class="n">make</span>
<span class="n">make</span> <span class="n">check</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>To change the destination directory (<code class="docutils literal"><span class="pre">/usr/local</span></code> by default), use
the <code class="docutils literal"><span class="pre">--prefix=DIR</span></code> argument to <code class="docutils literal"><span class="pre">./configure</span></code>. See <code class="docutils literal"><span class="pre">./configure</span>
<span class="pre">--help</span></code> for the list of all possible configuration options.</p>
<p>The command <code class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></code> runs the test suite distributed with
Jansson. This step is not strictly necessary, but it may find possible
problems that Jansson has on your platform. If any problems are found,
please report them.</p>
<p>If you obtained the source from a Git repository (or any other source
control system), there&#8217;s no <code class="docutils literal"><span class="pre">./configure</span></code> script as it&#8217;s not kept in
version control. To create the script, the build system needs to be
bootstrapped. There are many ways to do this, but the easiest one is
to use <code class="docutils literal"><span class="pre">autoreconf</span></code>:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">autoreconf</span> <span class="o">-</span><span class="n">fi</span>
</pre></div>
</div>
<p>This command creates the <code class="docutils literal"><span class="pre">./configure</span></code> script, which can then be
used as described above.</p>
</div>
<div class="section" id="cmake-various-platforms-including-windows">
<span id="build-cmake"></span><h5>CMake (various platforms, including Windows)<a class="headerlink" href="#cmake-various-platforms-including-windows" title="Permalink to this headline">¶</a></h5>
<p>Jansson can be built using <a class="reference external" href="http://www.cmake.org">CMake</a>. Create a build directory for an
out-of-tree build, change to that directory, and run <code class="docutils literal"><span class="pre">cmake</span></code> (or <code class="docutils literal"><span class="pre">ccmake</span></code>,
<code class="docutils literal"><span class="pre">cmake-gui</span></code>, or similar) to configure the project.</p>
<p>See the examples below for more detailed information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the below examples <code class="docutils literal"><span class="pre">..</span></code> is used as an argument for <code class="docutils literal"><span class="pre">cmake</span></code>.
This is simply the path to the jansson project root directory.
In the example it is assumed you&#8217;ve created a sub-directory <code class="docutils literal"><span class="pre">build</span></code>
and are using that. You could use any path you want.</p>
</div>
<div class="section" id="unix-make-files">
<span id="build-cmake-unix"></span><h6>Unix (Make files)<a class="headerlink" href="#unix-make-files" title="Permalink to this headline">¶</a></h6>
<p>Generating make files on unix:</p>
<pre class="literal-block">
bunzip2 -c jansson-2.9.tar.bz2 | tar xf -
cd jansson-2.9

mkdir build
cd build
cmake .. # or ccmake .. for a GUI.
</pre>
<p>Then to build:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">make</span>
<span class="n">make</span> <span class="n">check</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-visual-studio">
<h6>Windows (Visual Studio)<a class="headerlink" href="#windows-visual-studio" title="Permalink to this headline">¶</a></h6>
<p>Creating Visual Studio project files from the command line:</p>
<pre class="literal-block">
&lt;unpack&gt;
cd jansson-2.9

md build
cd build
cmake -G &quot;Visual Studio 10&quot; ..
</pre>
<p>You will now have a <em>Visual Studio Solution</em> in your build directory.
To run the unit tests build the <code class="docutils literal"><span class="pre">RUN_TESTS</span></code> project.</p>
<p>If you prefer a GUI the <code class="docutils literal"><span class="pre">cmake</span></code> line in the above example can
be replaced with:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">cmake</span><span class="o">-</span><span class="n">gui</span> <span class="p">..</span>
</pre></div>
</div>
<p>For command line help (including a list of available generators)
for <a class="reference external" href="http://www.cmake.org">CMake</a> simply run:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">cmake</span>
</pre></div>
</div>
<p>To list available <a class="reference external" href="http://www.cmake.org">CMake</a> settings (and what they are currently set to)
for the project, run:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">LH</span> <span class="p">..</span>
</pre></div>
</div>
</div>
<div class="section" id="mac-osx-xcode">
<h6>Mac OSX (Xcode)<a class="headerlink" href="#mac-osx-xcode" title="Permalink to this headline">¶</a></h6>
<p>If you prefer using Xcode instead of make files on OSX,
do the following. (Use the same steps as
for <a class="reference internal" href="#build-cmake-unix"><span>Unix</span></a>):</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">G</span> <span class="s">&quot;Xcode&quot;</span> <span class="p">..</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-cmake-settings">
<h6>Additional CMake settings<a class="headerlink" href="#additional-cmake-settings" title="Permalink to this headline">¶</a></h6>
<div class="section" id="shared-library">
<h7>Shared library<a class="headerlink" href="#shared-library" title="Permalink to this headline">¶</a></h7>
<p>By default the <a class="reference external" href="http://www.cmake.org">CMake</a> project will generate build files for building the
static library. To build the shared version use:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DJANSSON_BUILD_SHARED_LIBS</span><span class="o">=</span><span class="mi">1</span> <span class="p">..</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-install-directory-same-as-autoconf-prefix">
<h7>Changing install directory (same as autoconf &#8211;prefix)<a class="headerlink" href="#changing-install-directory-same-as-autoconf-prefix" title="Permalink to this headline">¶</a></h7>
<p>Just as with the <a class="reference external" href="http://www.gnu.org/software/autoconf/">autoconf</a> project you can change the destination directory
for <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code>. The equivalent for autoconfs <code class="docutils literal"><span class="pre">./configure</span> <span class="pre">--prefix</span></code>
in <a class="reference external" href="http://www.cmake.org">CMake</a> is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">cmake</span> <span class="o">-</span><span class="nl">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">some</span><span class="o">/</span><span class="n">other</span><span class="o">/</span><span class="n">path</span> <span class="p">..</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="android">
<h5>Android<a class="headerlink" href="#android" title="Permalink to this headline">¶</a></h5>
<p>Jansson can be built for Android platforms. Android.mk is in the
source root directory. The configuration header file is located in the
<code class="docutils literal"><span class="pre">android</span></code> directory in the source distribution.</p>
</div>
<div class="section" id="other-systems">
<h5>Other Systems<a class="headerlink" href="#other-systems" title="Permalink to this headline">¶</a></h5>
<p>On non Unix-like systems, you may be unable to run the <code class="docutils literal"><span class="pre">./configure</span></code>
script. In this case, follow these steps. All the files mentioned can
be found in the <code class="docutils literal"><span class="pre">src/</span></code> directory.</p>
<ol class="arabic simple">
<li>Create <code class="docutils literal"><span class="pre">jansson_config.h</span></code> (which has some platform-specific
parameters that are normally filled in by the <code class="docutils literal"><span class="pre">./configure</span></code>
script). Edit <code class="docutils literal"><span class="pre">jansson_config.h.in</span></code>, replacing all <code class="docutils literal"><span class="pre">&#64;variable&#64;</span></code>
placeholders, and rename the file to <code class="docutils literal"><span class="pre">jansson_config.h</span></code>.</li>
<li>Make <code class="docutils literal"><span class="pre">jansson.h</span></code> and <code class="docutils literal"><span class="pre">jansson_config.h</span></code> available to the
compiler, so that they can be found when compiling programs that
use Jansson.</li>
<li>Compile all the <code class="docutils literal"><span class="pre">.c</span></code> files (in the <code class="docutils literal"><span class="pre">src/</span></code> directory) into a
library file. Make the library available to the compiler, as in
step 2.</li>
</ol>
</div>
<div class="section" id="building-the-documentation">
<h5>Building the Documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this headline">¶</a></h5>
<p>(This subsection describes how to build the HTML documentation you are
currently reading, so it can be safely skipped.)</p>
<p>Documentation is in the <code class="docutils literal"><span class="pre">doc/</span></code> subdirectory. It&#8217;s written in
<a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> with <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> annotations. To generate the HTML
documentation, invoke:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
<p>and point your browser to <code class="docutils literal"><span class="pre">doc/_build/html/index.html</span></code>. <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> 1.0
or newer is required to generate the documentation.</p>
</div>
</div>
<div class="section" id="compiling-programs-that-use-jansson">
<h4>Compiling Programs that Use Jansson<a class="headerlink" href="#compiling-programs-that-use-jansson" title="Permalink to this headline">¶</a></h4>
<p>Jansson involves one C header file, <code class="file docutils literal"><span class="pre">jansson.h</span></code>, so it&#8217;s enough
to put the line</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;jansson.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>in the beginning of every source file that uses Jansson.</p>
<p>There&#8217;s also just one library to link with, <code class="docutils literal"><span class="pre">libjansson</span></code>. Compile and
link the program as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">-</span><span class="n">o</span> <span class="n">prog</span> <span class="n">prog</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">ljansson</span>
</pre></div>
</div>
<p>Starting from version 1.2, there&#8217;s also support for <a class="reference external" href="http://pkg-config.freedesktop.org/">pkg-config</a>:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>cc -o prog prog.c <span class="sb">`</span>pkg-config --cflags --libs jansson<span class="sb">`</span>
</pre></div>
</div>
</div>
</div>
<span id="document-upgrading"></span><div class="section" id="upgrading-from-1-x">
<h3>Upgrading from 1.x<a class="headerlink" href="#upgrading-from-1-x" title="Permalink to this headline">¶</a></h3>
<p>This chapter lists the backwards incompatible changes introduced in
Jansson 2.0, and the steps that are needed for upgrading your code.</p>
<p><strong>The incompatibilities are not dramatic.</strong> The biggest change is that
all decoding functions now require and extra parameter. Most programs
can be modified to work with 2.0 by adding a <code class="docutils literal"><span class="pre">0</span></code> as the second
parameter to all calls of <a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a>, <a class="reference internal" href="index.html#c.json_loadf" title="json_loadf"><code class="xref c c-func docutils literal"><span class="pre">json_loadf()</span></code></a>
and <a class="reference internal" href="index.html#c.json_load_file" title="json_load_file"><code class="xref c c-func docutils literal"><span class="pre">json_load_file()</span></code></a>.</p>
<div class="section" id="compatibility">
<h4>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h4>
<p>Jansson 2.0 is backwards incompatible with the Jansson 1.x releases.
It is ABI incompatible, i.e. all programs dynamically linking to the
Jansson library need to be recompiled. It&#8217;s also API incompatible,
i.e. the source code of programs using Jansson 1.x may need
modifications to make them compile against Jansson 2.0.</p>
<p>All the 2.x releases are guaranteed to be backwards compatible for
both ABI and API, so no recompilation or source changes are needed
when upgrading from 2.x to 2.y.</p>
</div>
<div class="section" id="list-of-incompatible-changes">
<h4>List of Incompatible Changes<a class="headerlink" href="#list-of-incompatible-changes" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><strong>Decoding flags</strong></dt>
<dd><p class="first">For future needs, a <code class="docutils literal"><span class="pre">flags</span></code> parameter was added as the second
parameter to all decoding functions, i.e. <a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a>,
<a class="reference internal" href="index.html#c.json_loadf" title="json_loadf"><code class="xref c c-func docutils literal"><span class="pre">json_loadf()</span></code></a> and <a class="reference internal" href="index.html#c.json_load_file" title="json_load_file"><code class="xref c c-func docutils literal"><span class="pre">json_load_file()</span></code></a>. All calls to
these functions need to be changed by adding a <code class="docutils literal"><span class="pre">0</span></code> as the second
argument. For example:</p>
<div class="last highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* old code */</span>
<span class="n">json_loads</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>

<span class="cm">/* new code */</span>
<span class="n">json_loads</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
</dd>
<dt><strong>Underlying type of JSON integers</strong></dt>
<dd><p class="first">The underlying C type of JSON integers has been changed from
<code class="xref c c-type docutils literal"><span class="pre">int</span></code> to the widest available signed integer type, i.e.
<code class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> or <code class="xref c c-type docutils literal"><span class="pre">long</span></code>, depending on whether
<code class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> is supported on your system or not. This makes
the whole 64-bit integer range available on most modern systems.</p>
<p class="last"><code class="docutils literal"><span class="pre">jansson.h</span></code> has a typedef <a class="reference internal" href="index.html#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a> to the underlying
integer type. <code class="xref c c-type docutils literal"><span class="pre">int</span></code> should still be used in most cases when
dealing with smallish JSON integers, as the compiler handles
implicit type coercion. Only when the full 64-bit range is needed,
<a class="reference internal" href="index.html#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a> should be explicitly used.</p>
</dd>
<dt><strong>Maximum encoder indentation depth</strong></dt>
<dd>The maximum argument of the <code class="docutils literal"><span class="pre">JSON_INDENT()</span></code> macro has been
changed from 255 to 31, to free up bits from the <code class="docutils literal"><span class="pre">flags</span></code>
parameter of <a class="reference internal" href="index.html#c.json_dumps" title="json_dumps"><code class="xref c c-func docutils literal"><span class="pre">json_dumps()</span></code></a>, <a class="reference internal" href="index.html#c.json_dumpf" title="json_dumpf"><code class="xref c c-func docutils literal"><span class="pre">json_dumpf()</span></code></a> and
<a class="reference internal" href="index.html#c.json_dump_file" title="json_dump_file"><code class="xref c c-func docutils literal"><span class="pre">json_dump_file()</span></code></a>. If your code uses a bigger indentation
than 31, it needs to be changed.</dd>
<dt><strong>Unsigned integers in API functions</strong></dt>
<dd>Version 2.0 unifies unsigned integer usage in the API. All uses of
<code class="xref c c-type docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span></code> and <code class="xref c c-type docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span></code> have been replaced
with <code class="xref c c-type docutils literal"><span class="pre">size_t</span></code>. This includes flags, container sizes, etc.
This should not require source code changes, as both
<code class="xref c c-type docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span></code> and <code class="xref c c-type docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span></code> are usually
compatible with <code class="xref c c-type docutils literal"><span class="pre">size_t</span></code>.</dd>
</dl>
</div>
</div>
<span id="document-tutorial"></span><div class="section" id="tutorial">
<span id="id1"></span><h3>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h3>
<p>In this tutorial, we create a program that fetches the latest commits
of a repository in <a class="reference external" href="https://github.com/">GitHub</a> over the web. <a class="reference external" href="http://developer.github.com/">GitHub API</a> uses JSON, so
the result can be parsed using Jansson.</p>
<p>To stick to the the scope of this tutorial, we will only cover the the
parts of the program related to handling JSON data. For the best user
experience, the full source code is available:
<a class="reference download internal" href="_downloads/github_commits.c"><code class="xref download docutils literal"><span class="pre">github_commits.c</span></code></a>. To compile it (on Unix-like systems with
gcc), use the following command:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">github_commits</span> <span class="n">github_commits</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">ljansson</span> <span class="o">-</span><span class="n">lcurl</span>
</pre></div>
</div>
<p><a class="reference external" href="http://curl.haxx.se/">libcurl</a> is used to communicate over the web, so it is required to
compile the program.</p>
<p>The command line syntax is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">github_commits</span> <span class="n">USER</span> <span class="n">REPOSITORY</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">USER</span></code> is a GitHub user ID and <code class="docutils literal"><span class="pre">REPOSITORY</span></code> is the repository
name. Please note that the GitHub API is rate limited, so if you run
the program too many times within a short period of time, the sever
starts to respond with an error.</p>
<div class="section" id="the-github-repo-commits-api">
<span id="tutorial-github-commits-api"></span><h4>The GitHub Repo Commits API<a class="headerlink" href="#the-github-repo-commits-api" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="http://developer.github.com/v3/repos/commits/">GitHub Repo Commits API</a> is used by sending HTTP requests to
URLs like <code class="docutils literal"><span class="pre">https://api.github.com/repos/USER/REPOSITORY/commits</span></code>,
where <code class="docutils literal"><span class="pre">USER</span></code> and <code class="docutils literal"><span class="pre">REPOSITORY</span></code> are the GitHub user ID and the name
of the repository whose commits are to be listed, respectively.</p>
<p>GitHub responds with a JSON array of the following form:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[
    {
        &quot;sha&quot;: &quot;&lt;the commit ID&gt;&quot;,
        &quot;commit&quot;: {
            &quot;message&quot;: &quot;&lt;the commit message&gt;&quot;,
            &lt;more fields, not important to this tutorial...&gt;
        },
        &lt;more fields...&gt;
    },
    {
        &quot;sha&quot;: &quot;&lt;the commit ID&gt;&quot;,
        &quot;commit&quot;: {
            &quot;message&quot;: &quot;&lt;the commit message&gt;&quot;,
            &lt;more fields...&gt;
        },
        &lt;more fields...&gt;
    },
    &lt;more commits...&gt;
]
</pre></div>
</div>
<p>In our program, the HTTP request is sent using the following
function:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">request</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">url</span><span class="p">);</span>
</pre></div>
</div>
<p>It takes the URL as a parameter, preforms a HTTP GET request, and
returns a newly allocated string that contains the response body. If
the request fails, an error message is printed to stderr and the
return value is <em>NULL</em>. For full details, refer to <a class="reference download internal" href="_downloads/github_commits.c"><code class="xref download docutils literal"><span class="pre">the</span> <span class="pre">code</span></code></a>, as the actual implementation is not important
here.</p>
</div>
<div class="section" id="the-program">
<span id="tutorial-the-program"></span><h4>The Program<a class="headerlink" href="#the-program" title="Permalink to this headline">¶</a></h4>
<p>First the includes:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;jansson.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>Like all the programs using Jansson, we need to include
<code class="file docutils literal"><span class="pre">jansson.h</span></code>.</p>
<p>The following definitions are used to build the GitHub API request
URL:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define URL_FORMAT   &quot;https:</span><span class="c1">//api.github.com/repos/%s/%s/commits&quot;</span>
<span class="cp">#define URL_SIZE     256</span>
</pre></div>
</div>
<p>The following function is used when formatting the result to find the
first newline in the commit message:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* Return the offset of the first newline in text or the length of</span>
<span class="cm">   text if there&#39;s no newline */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">newline_offset</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">newline</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">newline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strlen</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">newline</span> <span class="o">-</span> <span class="n">text</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The main function follows. In the beginning, we first declare a bunch
of variables and check the command line parameters:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">url</span><span class="p">[</span><span class="n">URL_SIZE</span><span class="p">];</span>

    <span class="n">json_t</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>
    <span class="n">json_error_t</span> <span class="n">error</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;usage: %s USER REPOSITORY</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;List commits at USER&#39;s REPOSITORY.</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Then we build the request URL using the user and repository names
given as command line parameters:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">snprintf</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">URL_SIZE</span><span class="p">,</span> <span class="n">URL_FORMAT</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</pre></div>
</div>
<p>This uses the <code class="docutils literal"><span class="pre">URL_SIZE</span></code> and <code class="docutils literal"><span class="pre">URL_FORMAT</span></code> constants defined above.
Now we&#8217;re ready to actually request the JSON data over the web:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>If an error occurs, our function <code class="docutils literal"><span class="pre">request</span></code> prints the error and
returns <em>NULL</em>, so it&#8217;s enough to just return 1 from the main
function.</p>
<p>Next we&#8217;ll call <a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a> to decode the JSON text we got
as a response:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">root</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: on line %d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">line</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We don&#8217;t need the JSON text anymore, so we can free the <code class="docutils literal"><span class="pre">text</span></code>
variable right after decoding it. If <a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a> fails, it
returns <em>NULL</em> and sets error information to the <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t"><code class="xref c c-type docutils literal"><span class="pre">json_error_t</span></code></a>
structure given as the second parameter. In this case, our program
prints the error information out and returns 1 from the main function.</p>
<p>Now we&#8217;re ready to extract the data out of the decoded JSON response.
The structure of the response JSON was explained in section
<a class="reference internal" href="#tutorial-github-commits-api"><span>The GitHub Repo Commits API</span></a>.</p>
<p>We check that the returned value really is an array:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json_is_array</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: root is not an array</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then we proceed to loop over all the commits in the array:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">json_array_size</span><span class="p">(</span><span class="n">root</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">json_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">sha</span><span class="p">,</span> <span class="o">*</span><span class="n">commit</span><span class="p">,</span> <span class="o">*</span><span class="n">message</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message_text</span><span class="p">;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">json_array_get</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json_is_object</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: commit data %d is not an object</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
<p>The function <a class="reference internal" href="index.html#c.json_array_size" title="json_array_size"><code class="xref c c-func docutils literal"><span class="pre">json_array_size()</span></code></a> returns the size of a JSON
array. First, we again declare some variables and then extract the
i&#8217;th element of the <code class="docutils literal"><span class="pre">root</span></code> array using <a class="reference internal" href="index.html#c.json_array_get" title="json_array_get"><code class="xref c c-func docutils literal"><span class="pre">json_array_get()</span></code></a>.
We also check that the resulting value is a JSON object.</p>
<p>Next we&#8217;ll extract the commit ID (a hexadecimal SHA-1 sum),
intermediate commit info object, and the commit message from that
object. We also do proper type checks:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>    <span class="n">sha</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;sha&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">sha</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: commit %d: sha is not a string</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">commit</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;commit&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json_is_object</span><span class="p">(</span><span class="n">commit</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: commit %d: commit is not an object</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">json_object_get</span><span class="p">(</span><span class="n">commit</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json_is_string</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: commit %d: message is not a string</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
<p>And finally, we&#8217;ll print the first 8 characters of the commit ID and
the first line of the commit message. A C-style string is extracted
from a JSON string using <a class="reference internal" href="index.html#c.json_string_value" title="json_string_value"><code class="xref c c-func docutils literal"><span class="pre">json_string_value()</span></code></a>:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>    <span class="n">message_text</span> <span class="o">=</span> <span class="n">json_string_value</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%.8s %.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
           <span class="n">json_string_value</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
           <span class="n">newline_offset</span><span class="p">(</span><span class="n">message_text</span><span class="p">),</span>
           <span class="n">message_text</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After sending the HTTP request, we decoded the JSON text using
<a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a>, remember? It returns a <em>new reference</em> to the
JSON value it decodes. When we&#8217;re finished with the value, we&#8217;ll need
to decrease the reference count using <a class="reference internal" href="index.html#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a>. This way
Jansson can release the resources:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_decref</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>For a detailed explanation of reference counting in Jansson, see
<a class="reference internal" href="index.html#apiref-reference-count"><span>Reference Count</span></a> in <a class="reference internal" href="index.html#apiref"><span>API Reference</span></a>.</p>
<p>The program&#8217;s ready, let&#8217;s test it and view the latest commits in
Jansson&#8217;s repository:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ ./github_commits akheron jansson
1581f26a Merge branch <span class="s1">&#39;2.3&#39;</span>
aabfd493 load: Change buffer_pos to be a size_t
bd72efbd load: Avoid unexpected behaviour in macro expansion
e8fd3e30 Document and tweak json_load_callback<span class="o">()</span>
873eddaf Merge pull request <span class="c1">#60 from rogerz/contrib</span>
bd2c0c73 Ignore the binary test_load_callback
17a51a4b Merge branch <span class="s1">&#39;2.3&#39;</span>
09c39adc Add json_load_callback to the list of exported symbols
cbb80baf Merge pull request <span class="c1">#57 from rogerz/contrib</span>
040bd7b0 Add json_load_callback<span class="o">()</span>
2637faa4 Make <span class="nb">test</span> stripping locale independent
&lt;...&gt;
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h4>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h4>
<p>In this tutorial, we implemented a program that fetches the latest
commits of a GitHub repository using the GitHub Repo Commits API.
Jansson was used to decode the JSON response and to extract the commit
data.</p>
<p>This tutorial only covered a small part of Jansson. For example, we
did not create or manipulate JSON values at all. Proceed to
<a class="reference internal" href="index.html#apiref"><span>API Reference</span></a> to explore all features of Jansson.</p>
</div>
</div>
<span id="document-conformance"></span><div class="section" id="rfc-conformance">
<span id="id1"></span><h3>RFC Conformance<a class="headerlink" href="#rfc-conformance" title="Permalink to this headline">¶</a></h3>
<p>JSON is specified in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>, <em>&#8220;The application/json Media Type
for JavaScript Object Notation (JSON)&#8221;</em>.</p>
<div class="section" id="character-encoding">
<h4>Character Encoding<a class="headerlink" href="#character-encoding" title="Permalink to this headline">¶</a></h4>
<p>Jansson only supports UTF-8 encoded JSON texts. It does not support or
auto-detect any of the other encodings mentioned in the RFC, namely
UTF-16LE, UTF-16BE, UTF-32LE or UTF-32BE. Pure ASCII is supported, as
it&#8217;s a subset of UTF-8.</p>
</div>
<div class="section" id="strings">
<h4>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h4>
<p>JSON strings are mapped to C-style null-terminated character arrays,
and UTF-8 encoding is used internally.</p>
<p>All Unicode codepoints U+0000 through U+10FFFF are allowed in string
values. However, U+0000 is not allowed in object keys because of API
restrictions.</p>
<p>Unicode normalization or any other transformation is never performed
on any strings (string values or object keys). When checking for
equivalence of strings or object keys, the comparison is performed
byte by byte between the original UTF-8 representations of the
strings.</p>
</div>
<div class="section" id="numbers">
<h4>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h4>
<div class="section" id="real-vs-integer">
<span id="id2"></span><h5>Real vs. Integer<a class="headerlink" href="#real-vs-integer" title="Permalink to this headline">¶</a></h5>
<p>JSON makes no distinction between real and integer numbers; Jansson
does. Real numbers are mapped to the <code class="docutils literal"><span class="pre">double</span></code> type and integers to
the <code class="docutils literal"><span class="pre">json_int_t</span></code> type, which is a typedef of <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> or
<code class="docutils literal"><span class="pre">long</span></code>, depending on whether <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> is supported by your
compiler or not.</p>
<p>A JSON number is considered to be a real number if its lexical
representation includes one of <code class="docutils literal"><span class="pre">e</span></code>, <code class="docutils literal"><span class="pre">E</span></code>, or <code class="docutils literal"><span class="pre">.</span></code>; regardless if
its actual numeric value is a true integer (e.g., all of <code class="docutils literal"><span class="pre">1E6</span></code>,
<code class="docutils literal"><span class="pre">3.0</span></code>, <code class="docutils literal"><span class="pre">400E-2</span></code>, and <code class="docutils literal"><span class="pre">3.14E3</span></code> are mathematical integers, but
will be treated as real values). With the <code class="docutils literal"><span class="pre">JSON_DECODE_INT_AS_REAL</span></code>
decoder flag set all numbers are interpreted as real.</p>
<p>All other JSON numbers are considered integers.</p>
<p>When encoding to JSON, real values are always represented
with a fractional part; e.g., the <code class="docutils literal"><span class="pre">double</span></code> value 3.0 will be
represented in JSON as <code class="docutils literal"><span class="pre">3.0</span></code>, not <code class="docutils literal"><span class="pre">3</span></code>.</p>
</div>
<div class="section" id="overflow-underflow-precision">
<h5>Overflow, Underflow &amp; Precision<a class="headerlink" href="#overflow-underflow-precision" title="Permalink to this headline">¶</a></h5>
<p>Real numbers whose absolute values are too small to be represented in
a C <code class="docutils literal"><span class="pre">double</span></code> will be silently estimated with 0.0. Thus, depending on
platform, JSON numbers very close to zero such as 1E-999 may result in
0.0.</p>
<p>Real numbers whose absolute values are too large to be represented in
a C <code class="docutils literal"><span class="pre">double</span></code> will result in an overflow error (a JSON decoding
error). Thus, depending on platform, JSON numbers like 1E+999 or
-1E+999 may result in a parsing error.</p>
<p>Likewise, integer numbers whose absolute values are too large to be
represented in the <code class="docutils literal"><span class="pre">json_int_t</span></code> type (see above) will result in an
overflow error (a JSON decoding error). Thus, depending on platform,
JSON numbers like 1000000000000000 may result in parsing error.</p>
<p>Parsing JSON real numbers may result in a loss of precision. As long
as overflow does not occur (i.e. a total loss of precision), the
rounded approximate value is silently used. Thus the JSON number
1.000000000000000005 may, depending on platform, result in the
<code class="docutils literal"><span class="pre">double</span></code> value 1.0.</p>
</div>
<div class="section" id="signed-zeros">
<h5>Signed zeros<a class="headerlink" href="#signed-zeros" title="Permalink to this headline">¶</a></h5>
<p>JSON makes no statement about what a number means; however Javascript
(ECMAscript) does state that +0.0 and -0.0 must be treated as being
distinct values, i.e. -0.0 ≠ 0.0. Jansson relies on the
underlying floating point library in the C environment in which it is
compiled. Therefore it is platform-dependent whether 0.0 and -0.0 will
be distinct values. Most platforms that use the IEEE 754
floating-point standard will support signed zeros.</p>
<p>Note that this only applies to floating-point; neither JSON, C, or
IEEE support the concept of signed integer zeros.</p>
</div>
<div class="section" id="types">
<h5>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h5>
<p>No support is provided in Jansson for any C numeric types other than
<code class="docutils literal"><span class="pre">json_int_t</span></code> and <code class="docutils literal"><span class="pre">double</span></code>. This excludes things such as unsigned
types, <code class="docutils literal"><span class="pre">long</span> <span class="pre">double</span></code>, etc. Obviously, shorter types like <code class="docutils literal"><span class="pre">short</span></code>,
<code class="docutils literal"><span class="pre">int</span></code>, <code class="docutils literal"><span class="pre">long</span></code> (if <code class="docutils literal"><span class="pre">json_int_t</span></code> is <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code>) and <code class="docutils literal"><span class="pre">float</span></code>
are implicitly handled via the ordinary C type coercion rules (subject
to overflow semantics). Also, no support or hooks are provided for any
supplemental &#8220;bignum&#8221; type add-on packages.</p>
</div>
<div class="section" id="depth-of-nested-values">
<h5>Depth of nested values<a class="headerlink" href="#depth-of-nested-values" title="Permalink to this headline">¶</a></h5>
<p>To avoid stack exhaustion, Jansson currently limits the nesting depth
for arrays and objects to a certain value (default: 2048), defined as
a macro <code class="docutils literal"><span class="pre">JSON_PARSER_MAX_DEPTH</span></code> within <code class="docutils literal"><span class="pre">jansson_config.h</span></code>.</p>
<p>The limit is allowed to be set by the RFC; there is no recommended value
or required minimum depth to be supported.</p>
</div>
</div>
</div>
<span id="document-portability"></span><div class="section" id="portability">
<h3>Portability<a class="headerlink" href="#portability" title="Permalink to this headline">¶</a></h3>
<div class="section" id="thread-safety">
<span id="portability-thread-safety"></span><h4>Thread safety<a class="headerlink" href="#thread-safety" title="Permalink to this headline">¶</a></h4>
<p>Jansson is thread safe and has no mutable global state. The only
exceptions are the hash function seed and memory allocation functions,
see below.</p>
<p>There&#8217;s no locking performed inside Jansson&#8217;s code, so a multithreaded
program must perform its own locking if JSON values are shared by
multiple threads. Jansson&#8217;s reference counting semantics may make this
a bit harder than it seems, as it&#8217;s possible to have a reference to a
value that&#8217;s also stored inside a list or object. Modifying the
container (adding or removing values) may trigger concurrent access to
such values, as containers manage the reference count of their
contained values. Bugs involving concurrent incrementing or
decrementing of deference counts may be hard to track.</p>
<p>The encoding functions (<a class="reference internal" href="index.html#c.json_dumps" title="json_dumps"><code class="xref c c-func docutils literal"><span class="pre">json_dumps()</span></code></a> and friends) track
reference loops by modifying the internal state of objects and arrays.
For this reason, encoding functions must not be run on the same JSON
values in two separate threads at the same time. As already noted
above, be especially careful if two arrays or objects share their
contained values with another array or object.</p>
<p>If you want to make sure that two JSON value hierarchies do not
contain shared values, use <a class="reference internal" href="index.html#c.json_deep_copy" title="json_deep_copy"><code class="xref c c-func docutils literal"><span class="pre">json_deep_copy()</span></code></a> to make copies.</p>
<div class="section" id="hash-function-seed">
<h5>Hash function seed<a class="headerlink" href="#hash-function-seed" title="Permalink to this headline">¶</a></h5>
<p>To prevent an attacker from intentionally causing large JSON objects
with specially crafted keys to perform very slow, the hash function
used by Jansson is randomized using a seed value. The seed is
automatically generated on the first explicit or implicit call to
<a class="reference internal" href="index.html#c.json_object" title="json_object"><code class="xref c c-func docutils literal"><span class="pre">json_object()</span></code></a>, if <a class="reference internal" href="index.html#c.json_object_seed" title="json_object_seed"><code class="xref c c-func docutils literal"><span class="pre">json_object_seed()</span></code></a> has not been
called beforehand.</p>
<p>The seed is generated by using operating system&#8217;s entropy sources if
they are available (<code class="docutils literal"><span class="pre">/dev/urandom</span></code>, <code class="docutils literal"><span class="pre">CryptGenRandom()</span></code>). The
initialization is done in as thread safe manner as possible, by using
architecture specific lockless operations if provided by the platform
or the compiler.</p>
<p>If you&#8217;re using threads, it&#8217;s recommended to autoseed the hashtable
explicitly before spawning any threads by calling
<code class="docutils literal"><span class="pre">json_object_seed(0)</span></code> , especially if you&#8217;re unsure whether the
initialization is thread safe on your platform.</p>
</div>
<div class="section" id="memory-allocation-functions">
<h5>Memory allocation functions<a class="headerlink" href="#memory-allocation-functions" title="Permalink to this headline">¶</a></h5>
<p>Memory allocation functions should be set at most once, and only on
program startup. See <a class="reference internal" href="index.html#apiref-custom-memory-allocation"><span>Custom Memory Allocation</span></a>.</p>
</div>
</div>
<div class="section" id="locale">
<h4>Locale<a class="headerlink" href="#locale" title="Permalink to this headline">¶</a></h4>
<p>Jansson works fine under any locale.</p>
<p>However, if the host program is multithreaded and uses <code class="docutils literal"><span class="pre">setlocale()</span></code>
to switch the locale in one thread while Jansson is currently encoding
or decoding JSON data in another thread, the result may be wrong or
the program may even crash.</p>
<p>Jansson uses locale specific functions for certain string conversions
in the encoder and decoder, and then converts the locale specific
values to/from the JSON representation. This fails if the locale
changes between the string conversion and the locale-to-JSON
conversion. This can only happen in multithreaded programs that use
<code class="docutils literal"><span class="pre">setlocale()</span></code>, because <code class="docutils literal"><span class="pre">setlocale()</span></code> switches the locale for all
running threads, not only the thread that calls <code class="docutils literal"><span class="pre">setlocale()</span></code>.</p>
<p>If your program uses <code class="docutils literal"><span class="pre">setlocale()</span></code> as described above, consider
using the thread-safe <code class="docutils literal"><span class="pre">uselocale()</span></code> instead.</p>
</div>
</div>
<span id="document-apiref"></span><div class="section" id="api-reference">
<span id="apiref"></span><h3>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h3>
<div class="section" id="preliminaries">
<h4>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">¶</a></h4>
<p>All declarations are in <code class="file docutils literal"><span class="pre">jansson.h</span></code>, so it&#8217;s enough to</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;jansson.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>in each source file.</p>
<p>All constants are prefixed with <code class="docutils literal"><span class="pre">JSON_</span></code> (except for those describing
the library version, prefixed with <code class="docutils literal"><span class="pre">JANSSON_</span></code>). Other identifiers
are prefixed with <code class="docutils literal"><span class="pre">json_</span></code>. Type names are suffixed with <code class="docutils literal"><span class="pre">_t</span></code> and
<code class="docutils literal"><span class="pre">typedef</span></code>&#8216;d so that the <code class="docutils literal"><span class="pre">struct</span></code> keyword need not be used.</p>
</div>
<div class="section" id="library-version">
<h4>Library Version<a class="headerlink" href="#library-version" title="Permalink to this headline">¶</a></h4>
<p>The Jansson version is of the form <em>A.B.C</em>, where <em>A</em> is the major
version, <em>B</em> is the minor version and <em>C</em> is the micro version. If the
micro version is zero, it&#8217;s omitted from the version string, i.e. the
version string is just <em>A.B</em>.</p>
<p>When a new release only fixes bugs and doesn&#8217;t add new features or
functionality, the micro version is incremented. When new features are
added in a backwards compatible way, the minor version is incremented
and the micro version is set to zero. When there are backwards
incompatible changes, the major version is incremented and others are
set to zero.</p>
<p>The following preprocessor constants specify the current version of
the library:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">JANSSON_MAJOR_VERSION</span></code>, <code class="docutils literal"><span class="pre">JANSSON_MINOR_VERSION</span></code>, <code class="docutils literal"><span class="pre">JANSSON_MICRO_VERSION</span></code></dt>
<dd>Integers specifying the major, minor and micro versions,
respectively.</dd>
<dt><code class="docutils literal"><span class="pre">JANSSON_VERSION</span></code></dt>
<dd>A string representation of the current version, e.g. <code class="docutils literal"><span class="pre">&quot;1.2.1&quot;</span></code> or
<code class="docutils literal"><span class="pre">&quot;1.3&quot;</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">JANSSON_VERSION_HEX</span></code></dt>
<dd><p class="first">A 3-byte hexadecimal representation of the version, e.g.
<code class="docutils literal"><span class="pre">0x010201</span></code> for version 1.2.1 and <code class="docutils literal"><span class="pre">0x010300</span></code> for version 1.3.
This is useful in numeric comparisons, e.g.:</p>
<div class="last highlight-c"><div class="highlight"><pre><span></span><span class="cp">#if JANSSON_VERSION_HEX &gt;= 0x010300</span>
<span class="cm">/* Code specific to version 1.3 and above */</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="value-representation">
<h4>Value Representation<a class="headerlink" href="#value-representation" title="Permalink to this headline">¶</a></h4>
<p>The JSON specification (<span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>) defines the following data types:
<em>object</em>, <em>array</em>, <em>string</em>, <em>number</em>, <em>boolean</em>, and <em>null</em>. JSON
types are used dynamically; arrays and objects can hold any other data
type, including themselves. For this reason, Jansson&#8217;s type system is
also dynamic in nature. There&#8217;s one C type to represent all JSON
values, and this structure knows the type of the JSON value it holds.</p>
<dl class="type">
<dt id="c.json_t">
<code class="descname">json_t</code><a class="headerlink" href="#c.json_t" title="Permalink to this definition">¶</a></dt>
<dd><p>This data structure is used throughout the library to represent all
JSON values. It always contains the type of the JSON value it holds
and the value&#8217;s reference count. The rest depends on the type of the
value.</p>
</dd></dl>

<p>Objects of <a class="reference internal" href="#c.json_t" title="json_t"><code class="xref c c-type docutils literal"><span class="pre">json_t</span></code></a> are always used through a pointer. There
are APIs for querying the type, manipulating the reference count, and
for constructing and manipulating values of different types.</p>
<p>Unless noted otherwise, all API functions return an error value if an
error occurs. Depending on the function&#8217;s signature, the error value
is either <em>NULL</em> or -1. Invalid arguments or invalid input are
apparent sources for errors. Memory allocation and I/O operations may
also cause errors.</p>
<div class="section" id="type">
<h5>Type<a class="headerlink" href="#type" title="Permalink to this headline">¶</a></h5>
<dl class="type">
<dt id="c.json_type">
enum <code class="descname">json_type</code><a class="headerlink" href="#c.json_type" title="Permalink to this definition">¶</a></dt>
<dd><p>The type of a JSON value. The following members are defined:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">JSON_OBJECT</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">JSON_ARRAY</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">JSON_STRING</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">JSON_INTEGER</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">JSON_REAL</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">JSON_TRUE</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">JSON_FALSE</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">JSON_NULL</span></code></td>
</tr>
</tbody>
</table>
<p>These correspond to JSON object, array, string, number, boolean and
null. A number is represented by either a value of the type
<code class="docutils literal"><span class="pre">JSON_INTEGER</span></code> or of the type <code class="docutils literal"><span class="pre">JSON_REAL</span></code>. A true boolean value
is represented by a value of the type <code class="docutils literal"><span class="pre">JSON_TRUE</span></code> and false by a
value of the type <code class="docutils literal"><span class="pre">JSON_FALSE</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_typeof">
int <code class="descname">json_typeof</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_typeof" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the type of the JSON value (a <a class="reference internal" href="#c.json_type" title="json_type"><code class="xref c c-type docutils literal"><span class="pre">json_type</span></code></a> cast to
<code class="xref c c-type docutils literal"><span class="pre">int</span></code>). <em>json</em> MUST NOT be <em>NULL</em>. This function is actually
implemented as a macro for speed.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_is_object">
<code class="descname">json_is_object</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_object" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_array">
<code class="descname">json_is_array</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_array" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_string">
<code class="descname">json_is_string</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_string" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_integer">
<code class="descname">json_is_integer</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_integer" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_real">
<code class="descname">json_is_real</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_real" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_true">
<code class="descname">json_is_true</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_true" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_false">
<code class="descname">json_is_false</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_false" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_is_null">
<code class="descname">json_is_null</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_null" title="Permalink to this definition">¶</a></dt>
<dd><p>These functions (actually macros) return true (non-zero) for values
of the given type, and false (zero) for values of other types and
for <em>NULL</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_is_number">
<code class="descname">json_is_number</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true for values of types <code class="docutils literal"><span class="pre">JSON_INTEGER</span></code> and
<code class="docutils literal"><span class="pre">JSON_REAL</span></code>, and false for other types and for <em>NULL</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_is_boolean">
<code class="descname">json_is_boolean</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_is_boolean" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true for types <code class="docutils literal"><span class="pre">JSON_TRUE</span></code> and <code class="docutils literal"><span class="pre">JSON_FALSE</span></code>, and false
for values of other types and for <em>NULL</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_boolean_value">
<code class="descname">json_boolean_value</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_boolean_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias of <a class="reference internal" href="#c.json_is_true" title="json_is_true"><code class="xref c c-func docutils literal"><span class="pre">json_is_true()</span></code></a>, i.e. returns 1 for <code class="docutils literal"><span class="pre">JSON_TRUE</span></code>
and 0 otherwise.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="reference-count">
<span id="apiref-reference-count"></span><h5>Reference Count<a class="headerlink" href="#reference-count" title="Permalink to this headline">¶</a></h5>
<p>The reference count is used to track whether a value is still in use
or not. When a value is created, it&#8217;s reference count is set to 1. If
a reference to a value is kept (e.g. a value is stored somewhere for
later use), its reference count is incremented, and when the value is
no longer needed, the reference count is decremented. When the
reference count drops to zero, there are no references left, and the
value can be destroyed.</p>
<dl class="function">
<dt id="c.json_incref">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_incref</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_incref" title="Permalink to this definition">¶</a></dt>
<dd><p>Increment the reference count of <em>json</em> if it&#8217;s not <em>NULL</em>.
Returns <em>json</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_decref">
void <code class="descname">json_decref</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_decref" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrement the reference count of <em>json</em>. As soon as a call to
<a class="reference internal" href="#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a> drops the reference count to zero, the value
is destroyed and it can no longer be used.</p>
</dd></dl>

<p>Functions creating new JSON values set the reference count to 1. These
functions are said to return a <strong>new reference</strong>. Other functions
returning (existing) JSON values do not normally increase the
reference count. These functions are said to return a <strong>borrowed
reference</strong>. So, if the user will hold a reference to a value returned
as a borrowed reference, he must call <a class="reference internal" href="#c.json_incref" title="json_incref"><code class="xref c c-func docutils literal"><span class="pre">json_incref()</span></code></a>. As soon as
the value is no longer needed, <a class="reference internal" href="#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a> should be called
to release the reference.</p>
<p>Normally, all functions accepting a JSON value as an argument will
manage the reference, i.e. increase and decrease the reference count
as needed. However, some functions <strong>steal</strong> the reference, i.e. they
have the same result as if the user called <a class="reference internal" href="#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a> on
the argument right after calling the function. These functions are
suffixed with <code class="docutils literal"><span class="pre">_new</span></code> or have <code class="docutils literal"><span class="pre">_new_</span></code> somewhere in their name.</p>
<p>For example, the following code creates a new JSON array and appends
an integer to it:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_t</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">integer</span><span class="p">;</span>

<span class="n">array</span> <span class="o">=</span> <span class="n">json_array</span><span class="p">();</span>
<span class="n">integer</span> <span class="o">=</span> <span class="n">json_integer</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>

<span class="n">json_array_append</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">integer</span><span class="p">);</span>
<span class="n">json_decref</span><span class="p">(</span><span class="n">integer</span><span class="p">);</span>
</pre></div>
</div>
<p>Note how the caller has to release the reference to the integer value
by calling <a class="reference internal" href="#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a>. By using a reference stealing
function <a class="reference internal" href="#c.json_array_append_new" title="json_array_append_new"><code class="xref c c-func docutils literal"><span class="pre">json_array_append_new()</span></code></a> instead of
<a class="reference internal" href="#c.json_array_append" title="json_array_append"><code class="xref c c-func docutils literal"><span class="pre">json_array_append()</span></code></a>, the code becomes much simpler:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_t</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="n">json_array</span><span class="p">();</span>
<span class="n">json_array_append_new</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">json_integer</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
</pre></div>
</div>
<p>In this case, the user doesn&#8217;t have to explicitly release the
reference to the integer value, as <a class="reference internal" href="#c.json_array_append_new" title="json_array_append_new"><code class="xref c c-func docutils literal"><span class="pre">json_array_append_new()</span></code></a>
steals the reference when appending the value to the array.</p>
<p>In the following sections it is clearly documented whether a function
will return a new or borrowed reference or steal a reference to its
argument.</p>
</div>
<div class="section" id="circular-references">
<h5>Circular References<a class="headerlink" href="#circular-references" title="Permalink to this headline">¶</a></h5>
<p>A circular reference is created when an object or an array is,
directly or indirectly, inserted inside itself. The direct case is
simple:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_t</span> <span class="o">*</span><span class="n">obj</span> <span class="o">=</span> <span class="n">json_object</span><span class="p">();</span>
<span class="n">json_object_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
</pre></div>
</div>
<p>Jansson will refuse to do this, and <a class="reference internal" href="#c.json_object_set" title="json_object_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_set()</span></code></a> (and
all the other such functions for objects and arrays) will return with
an error status. The indirect case is the dangerous one:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_t</span> <span class="o">*</span><span class="n">arr1</span> <span class="o">=</span> <span class="n">json_array</span><span class="p">(),</span> <span class="o">*</span><span class="n">arr2</span> <span class="o">=</span> <span class="n">json_array</span><span class="p">();</span>
<span class="n">json_array_append</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">);</span>
<span class="n">json_array_append</span><span class="p">(</span><span class="n">arr2</span><span class="p">,</span> <span class="n">arr1</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, the array <code class="docutils literal"><span class="pre">arr2</span></code> is contained in the array
<code class="docutils literal"><span class="pre">arr1</span></code>, and vice versa. Jansson cannot check for this kind of
indirect circular references without a performance hit, so it&#8217;s up to
the user to avoid them.</p>
<p>If a circular reference is created, the memory consumed by the values
cannot be freed by <a class="reference internal" href="#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a>. The reference counts never
drops to zero because the values are keeping the references to each
other. Moreover, trying to encode the values with any of the encoding
functions will fail. The encoder detects circular references and
returns an error status.</p>
</div>
<div class="section" id="scope-dereferencing">
<h5>Scope Dereferencing<a class="headerlink" href="#scope-dereferencing" title="Permalink to this headline">¶</a></h5>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.9.</span></p>
</div>
<p>It is possible to use the <code class="docutils literal"><span class="pre">json_auto_t</span></code> type to automatically
dereference a value at the end of a scope. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">function</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">json_auto_t</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">json_string</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
  <span class="cm">/* json_decref(value) is automatically called. */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This feature is only available on GCC and Clang. So if your project
has a portability requirement for other compilers, you should avoid
this feature.</p>
<p>Additionally, as always, care should be taken when passing values to
functions that steal references.</p>
</div>
</div>
<div class="section" id="true-false-and-null">
<h4>True, False and Null<a class="headerlink" href="#true-false-and-null" title="Permalink to this headline">¶</a></h4>
<p>These three values are implemented as singletons, so the returned
pointers won&#8217;t change between invocations of these functions.</p>
<dl class="function">
<dt id="c.json_true">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_true</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.json_true" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns the JSON true value.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_false">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_false</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.json_false" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns the JSON false value.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_boolean">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_boolean</code><span class="sig-paren">(</span>val<span class="sig-paren">)</span><a class="headerlink" href="#c.json_boolean" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns JSON false if <code class="docutils literal"><span class="pre">val</span></code> is zero, and JSON true otherwise.
This is a macro, and equivalent to <code class="docutils literal"><span class="pre">val</span> <span class="pre">?</span> <span class="pre">json_true()</span> <span class="pre">:</span>
<span class="pre">json_false()</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_null">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_null</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.json_null" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns the JSON null value.</p>
</dd></dl>

</div>
<div class="section" id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline">¶</a></h4>
<p>Jansson uses UTF-8 as the character encoding. All JSON strings must be
valid UTF-8 (or ASCII, as it&#8217;s a subset of UTF-8). All Unicode
codepoints U+0000 through U+10FFFF are allowed, but you must use
length-aware functions if you wish to embed null bytes in strings.</p>
<dl class="function">
<dt id="c.json_string">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_string</code><span class="sig-paren">(</span>const char<em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a new JSON string, or <em>NULL</em> on error. <em>value</em> must be a
valid null terminated UTF-8 encoded Unicode string.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_stringn">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_stringn</code><span class="sig-paren">(</span>const char<em>&nbsp;*value</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_stringn" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Like <a class="reference internal" href="#c.json_string" title="json_string"><code class="xref c c-func docutils literal"><span class="pre">json_string()</span></code></a>, but with explicit length, so <em>value</em> may
contain null characters or not be null terminated.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_nocheck">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_string_nocheck</code><span class="sig-paren">(</span>const char<em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Like <a class="reference internal" href="#c.json_string" title="json_string"><code class="xref c c-func docutils literal"><span class="pre">json_string()</span></code></a>, but doesn&#8217;t check that <em>value</em> is valid
UTF-8. Use this function only if you are certain that this really
is the case (e.g. you have already checked it by other means).</p>
</dd></dl>

<dl class="function">
<dt id="c.json_stringn_nocheck">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_stringn_nocheck</code><span class="sig-paren">(</span>const char<em>&nbsp;*value</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_stringn_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Like <a class="reference internal" href="#c.json_string_nocheck" title="json_string_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_string_nocheck()</span></code></a>, but with explicit length, so
<em>value</em> may contain null characters or not be null terminated.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_value">
const char *<code class="descname">json_string_value</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the associated value of <em>string</em> as a null terminated UTF-8
encoded string, or <em>NULL</em> if <em>string</em> is not a JSON string.</p>
<p>The returned value is read-only and must not be modified or freed by
the user. It is valid as long as <em>string</em> exists, i.e. as long as
its reference count has not dropped to zero.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_length">
size_t <code class="descname">json_string_length</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the length of <em>string</em> in its UTF-8 presentation, or zero
if <em>string</em> is not a JSON string.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_set">
int <code class="descname">json_string_set</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em>, const char<em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the associated value of <em>string</em> to <em>value</em>. <em>value</em> must be a
valid UTF-8 encoded Unicode string. Returns 0 on success and -1 on
error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_setn">
int <code class="descname">json_string_setn</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em>, const char<em>&nbsp;*value</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_setn" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_string_set" title="json_string_set"><code class="xref c c-func docutils literal"><span class="pre">json_string_set()</span></code></a>, but with explicit length, so <em>value</em>
may contain null characters or not be null terminated.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_set_nocheck">
int <code class="descname">json_string_set_nocheck</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em>, const char<em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_set_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_string_set" title="json_string_set"><code class="xref c c-func docutils literal"><span class="pre">json_string_set()</span></code></a>, but doesn&#8217;t check that <em>value</em> is
valid UTF-8. Use this function only if you are certain that this
really is the case (e.g. you have already checked it by other
means).</p>
</dd></dl>

<dl class="function">
<dt id="c.json_string_setn_nocheck">
int <code class="descname">json_string_setn_nocheck</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*string</em>, const char<em>&nbsp;*value</em>, size_t<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_string_setn_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_string_set_nocheck" title="json_string_set_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_string_set_nocheck()</span></code></a>, but with explicit length,
so <em>value</em> may contain null characters or not be null terminated.</p>
</dd></dl>

</div>
<div class="section" id="number">
<h4>Number<a class="headerlink" href="#number" title="Permalink to this headline">¶</a></h4>
<p>The JSON specification only contains one numeric type, &#8220;number&#8221;. The C
programming language has distinct types for integer and floating-point
numbers, so for practical reasons Jansson also has distinct types for
the two. They are called &#8220;integer&#8221; and &#8220;real&#8221;, respectively. For more
information, see <a class="reference internal" href="index.html#rfc-conformance"><span>RFC Conformance</span></a>.</p>
<dl class="type">
<dt id="c.json_int_t">
<code class="descname">json_int_t</code><a class="headerlink" href="#c.json_int_t" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the C type that is used to store JSON integer values. It
represents the widest integer type available on your system. In
practice it&#8217;s just a typedef of <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> if your compiler
supports it, otherwise <code class="docutils literal"><span class="pre">long</span></code>.</p>
<p>Usually, you can safely use plain <code class="docutils literal"><span class="pre">int</span></code> in place of
<code class="docutils literal"><span class="pre">json_int_t</span></code>, and the implicit C integer conversion handles the
rest. Only when you know that you need the full 64-bit range, you
should use <code class="docutils literal"><span class="pre">json_int_t</span></code> explicitly.</p>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">JSON_INTEGER_IS_LONG_LONG</span></code></dt>
<dd><p class="first">This is a preprocessor variable that holds the value 1 if
<a class="reference internal" href="#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a> is <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code>, and 0 if it&#8217;s <code class="docutils literal"><span class="pre">long</span></code>. It
can be used as follows:</p>
<div class="last highlight-c"><div class="highlight"><pre><span></span><span class="cp">#if JSON_INTEGER_IS_LONG_LONG</span>
<span class="cm">/* Code specific for long long */</span>
<span class="cp">#else</span>
<span class="cm">/* Code specific for long */</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_INTEGER_FORMAT</span></code></dt>
<dd><p class="first">This is a macro that expands to a <code class="xref c c-func docutils literal"><span class="pre">printf()</span></code> conversion
specifier that corresponds to <a class="reference internal" href="#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a>, without the
leading <code class="docutils literal"><span class="pre">%</span></code> sign, i.e. either <code class="docutils literal"><span class="pre">&quot;lld&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;ld&quot;</span></code>. This macro
is required because the actual type of <a class="reference internal" href="#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a> can be
either <code class="docutils literal"><span class="pre">long</span></code> or <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code>, and <code class="xref c c-func docutils literal"><span class="pre">printf()</span></code> requires
different length modifiers for the two.</p>
<p>Example:</p>
<div class="last highlight-c"><div class="highlight"><pre><span></span><span class="n">json_int_t</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">123123123</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;x is %&quot;</span> <span class="n">JSON_INTEGER_FORMAT</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="function">
<dt id="c.json_integer">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_integer</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_int_t" title="json_int_t">json_int_t</a><em>&nbsp;value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_integer" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a new JSON integer, or <em>NULL</em> on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_integer_value">
<a class="reference internal" href="index.html#c.json_int_t" title="json_int_t">json_int_t</a> <code class="descname">json_integer_value</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*integer</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_integer_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the associated value of <em>integer</em>, or 0 if <em>json</em> is not a
JSON integer.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_integer_set">
int <code class="descname">json_integer_set</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*integer</em>, <a class="reference internal" href="index.html#c.json_int_t" title="json_int_t">json_int_t</a><em>&nbsp;value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_integer_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the associated value of <em>integer</em> to <em>value</em>. Returns 0 on
success and -1 if <em>integer</em> is not a JSON integer.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_real">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_real</code><span class="sig-paren">(</span>double<em>&nbsp;value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_real" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a new JSON real, or <em>NULL</em> on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_real_value">
double <code class="descname">json_real_value</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*real</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_real_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the associated value of <em>real</em>, or 0.0 if <em>real</em> is not a
JSON real.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_real_set">
int <code class="descname">json_real_set</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*real</em>, double<em>&nbsp;value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_real_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the associated value of <em>real</em> to <em>value</em>. Returns 0 on
success and -1 if <em>real</em> is not a JSON real.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_number_value">
double <code class="descname">json_number_value</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_number_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the associated value of the JSON integer or JSON real
<em>json</em>, cast to double regardless of the actual type. If <em>json</em> is
neither JSON real nor JSON integer, 0.0 is returned.</p>
</dd></dl>

</div>
<div class="section" id="array">
<h4>Array<a class="headerlink" href="#array" title="Permalink to this headline">¶</a></h4>
<p>A JSON array is an ordered collection of other JSON values.</p>
<dl class="function">
<dt id="c.json_array">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_array</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.json_array" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a new JSON array, or <em>NULL</em> on error. Initially, the array
is empty.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_size">
size_t <code class="descname">json_array_size</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of elements in <em>array</em>, or 0 if <em>array</em> is NULL
or not a JSON array.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_get">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_array_get</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_get" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p>Returns the element in <em>array</em> at position <em>index</em>. The valid range
for <em>index</em> is from 0 to the return value of
<a class="reference internal" href="#c.json_array_size" title="json_array_size"><code class="xref c c-func docutils literal"><span class="pre">json_array_size()</span></code></a> minus 1. If <em>array</em> is not a JSON array,
if <em>array</em> is <em>NULL</em>, or if <em>index</em> is out of range, <em>NULL</em> is
returned.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_set">
int <code class="descname">json_array_set</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Replaces the element in <em>array</em> at position <em>index</em> with <em>value</em>.
The valid range for <em>index</em> is from 0 to the return value of
<a class="reference internal" href="#c.json_array_size" title="json_array_size"><code class="xref c c-func docutils literal"><span class="pre">json_array_size()</span></code></a> minus 1. Returns 0 on success and -1 on
error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_set_new">
int <code class="descname">json_array_set_new</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_set_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_array_set" title="json_array_set"><code class="xref c c-func docutils literal"><span class="pre">json_array_set()</span></code></a> but steals the reference to <em>value</em>.
This is useful when <em>value</em> is newly created and not used after
the call.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_append">
int <code class="descname">json_array_append</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_append" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends <em>value</em> to the end of <em>array</em>, growing the size of <em>array</em>
by 1. Returns 0 on success and -1 on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_append_new">
int <code class="descname">json_array_append_new</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_append_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_array_append" title="json_array_append"><code class="xref c c-func docutils literal"><span class="pre">json_array_append()</span></code></a> but steals the reference to
<em>value</em>. This is useful when <em>value</em> is newly created and not used
after the call.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_insert">
int <code class="descname">json_array_insert</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Inserts <em>value</em> to <em>array</em> at position <em>index</em>, shifting the
elements at <em>index</em> and after it one position towards the end of
the array. Returns 0 on success and -1 on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_insert_new">
int <code class="descname">json_array_insert_new</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_insert_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_array_insert" title="json_array_insert"><code class="xref c c-func docutils literal"><span class="pre">json_array_insert()</span></code></a> but steals the reference to
<em>value</em>. This is useful when <em>value</em> is newly created and not used
after the call.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_remove">
int <code class="descname">json_array_remove</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, size_t<em>&nbsp;index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the element in <em>array</em> at position <em>index</em>, shifting the
elements after <em>index</em> one position towards the start of the array.
Returns 0 on success and -1 on error. The reference count of the
removed value is decremented.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_clear">
int <code class="descname">json_array_clear</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all elements from <em>array</em>. Returns 0 on success and -1 on
error. The reference count of all removed values are decremented.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_extend">
int <code class="descname">json_array_extend</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*array</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*other_array</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_extend" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends all elements in <em>other_array</em> to the end of <em>array</em>.
Returns 0 on success and -1 on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_array_foreach">
<code class="descname">json_array_foreach</code><span class="sig-paren">(</span>array, index, value<span class="sig-paren">)</span><a class="headerlink" href="#c.json_array_foreach" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over every element of <code class="docutils literal"><span class="pre">array</span></code>, running the block
of code that follows each time with the proper values set to
variables <code class="docutils literal"><span class="pre">index</span></code> and <code class="docutils literal"><span class="pre">value</span></code>, of types <code class="xref c c-type docutils literal"><span class="pre">size_t</span></code> and
<a class="reference internal" href="#c.json_t" title="json_t"><code class="xref c c-type docutils literal"><span class="pre">json_t</span> <span class="pre">*</span></code></a> respectively. Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* array is a JSON array */</span>
<span class="kt">size_t</span> <span class="n">index</span><span class="p">;</span>
<span class="n">json_t</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>

<span class="n">json_array_foreach</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* block of code that uses index and value */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The items are returned in increasing index order.</p>
<p>This macro expands to an ordinary <code class="docutils literal"><span class="pre">for</span></code> statement upon
preprocessing, so its performance is equivalent to that of
hand-written code using the array access functions.
The main advantage of this macro is that it abstracts
away the complexity, and makes for more concise and readable code.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="object">
<h4>Object<a class="headerlink" href="#object" title="Permalink to this headline">¶</a></h4>
<p>A JSON object is a dictionary of key-value pairs, where the key is a
Unicode string and the value is any JSON value.</p>
<p>Even though null bytes are allowed in string values, they are not
allowed in object keys.</p>
<dl class="function">
<dt id="c.json_object">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_object</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.json_object" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a new JSON object, or <em>NULL</em> on error. Initially, the
object is empty.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_size">
size_t <code class="descname">json_object_size</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of elements in <em>object</em>, or 0 if <em>object</em> is not
a JSON object.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_get">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_object_get</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_get" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p>Get a value corresponding to <em>key</em> from <em>object</em>. Returns <em>NULL</em> if
<em>key</em> is not found and on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_set">
int <code class="descname">json_object_set</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the value of <em>key</em> to <em>value</em> in <em>object</em>. <em>key</em> must be a
valid null terminated UTF-8 encoded Unicode string. If there
already is a value for <em>key</em>, it is replaced by the new value.
Returns 0 on success and -1 on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_set_nocheck">
int <code class="descname">json_object_set_nocheck</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_set_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_set" title="json_object_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_set()</span></code></a>, but doesn&#8217;t check that <em>key</em> is
valid UTF-8. Use this function only if you are certain that this
really is the case (e.g. you have already checked it by other
means).</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_set_new">
int <code class="descname">json_object_set_new</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_set_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_set" title="json_object_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_set()</span></code></a> but steals the reference to
<em>value</em>. This is useful when <em>value</em> is newly created and not used
after the call.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_set_new_nocheck">
int <code class="descname">json_object_set_new_nocheck</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_set_new_nocheck" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_set_new" title="json_object_set_new"><code class="xref c c-func docutils literal"><span class="pre">json_object_set_new()</span></code></a>, but doesn&#8217;t check that <em>key</em> is
valid UTF-8. Use this function only if you are certain that this
really is the case (e.g. you have already checked it by other
means).</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_del">
int <code class="descname">json_object_del</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_del" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete <em>key</em> from <em>object</em> if it exists. Returns 0 on success, or
-1 if <em>key</em> was not found. The reference count of the removed value
is decremented.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_clear">
int <code class="descname">json_object_clear</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all elements from <em>object</em>. Returns 0 on success and -1 if
<em>object</em> is not a JSON object. The reference count of all removed
values are decremented.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_update">
int <code class="descname">json_object_update</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*other</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update <em>object</em> with the key-value pairs from <em>other</em>, overwriting
existing keys. Returns 0 on success or -1 on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_update_existing">
int <code class="descname">json_object_update_existing</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*other</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_update_existing" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_update" title="json_object_update"><code class="xref c c-func docutils literal"><span class="pre">json_object_update()</span></code></a>, but only the values of existing
keys are updated. No new keys are created. Returns 0 on success or
-1 on error.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_object_update_missing">
int <code class="descname">json_object_update_missing</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*other</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_update_missing" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_update" title="json_object_update"><code class="xref c c-func docutils literal"><span class="pre">json_object_update()</span></code></a>, but only new keys are created.
The value of any existing key is not changed. Returns 0 on success
or -1 on error.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_object_foreach">
<code class="descname">json_object_foreach</code><span class="sig-paren">(</span>object, key, value<span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_foreach" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over every key-value pair of <code class="docutils literal"><span class="pre">object</span></code>, running the block
of code that follows each time with the proper values set to
variables <code class="docutils literal"><span class="pre">key</span></code> and <code class="docutils literal"><span class="pre">value</span></code>, of types <code class="xref c c-type docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span></code> and
<a class="reference internal" href="#c.json_t" title="json_t"><code class="xref c c-type docutils literal"><span class="pre">json_t</span> <span class="pre">*</span></code></a> respectively. Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* obj is a JSON object */</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>
<span class="n">json_t</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>

<span class="n">json_object_foreach</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* block of code that uses key and value */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The items are returned in the order they were inserted to the
object.</p>
<p><strong>Note:</strong> It&#8217;s not safe to call <code class="docutils literal"><span class="pre">json_object_del(object,</span> <span class="pre">key)</span></code>
during iteration. If you need to, use
<a class="reference internal" href="#c.json_object_foreach_safe" title="json_object_foreach_safe"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach_safe()</span></code></a> instead.</p>
<p>This macro expands to an ordinary <code class="docutils literal"><span class="pre">for</span></code> statement upon
preprocessing, so its performance is equivalent to that of
hand-written iteration code using the object iteration protocol
(see below). The main advantage of this macro is that it abstracts
away the complexity behind iteration, and makes for more concise and
readable code.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_object_foreach_safe">
<code class="descname">json_object_foreach_safe</code><span class="sig-paren">(</span>object, tmp, key, value<span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_foreach_safe" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_foreach" title="json_object_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach()</span></code></a>, but it&#8217;s safe to call
<code class="docutils literal"><span class="pre">json_object_del(object,</span> <span class="pre">key)</span></code> during iteration. You need to pass
an extra <code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></code> parameter <code class="docutils literal"><span class="pre">tmp</span></code> that is used for temporary storage.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.8.</span></p>
</div>
</dd></dl>

<p>The following functions can be used to iterate through all key-value
pairs in an object. The items are returned in the order they were
inserted to the object.</p>
<dl class="function">
<dt id="c.json_object_iter">
void *<code class="descname">json_object_iter</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an opaque iterator which can be used to iterate over all
key-value pairs in <em>object</em>, or <em>NULL</em> if <em>object</em> is empty.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_at">
void *<code class="descname">json_object_iter_at</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, const char<em>&nbsp;*key</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_at" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_iter" title="json_object_iter"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter()</span></code></a>, but returns an iterator to the
key-value pair in <em>object</em> whose key is equal to <em>key</em>, or NULL if
<em>key</em> is not found in <em>object</em>. Iterating forward to the end of
<em>object</em> only yields all key-value pairs of the object if <em>key</em>
happens to be the first key in the underlying hash table.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_next">
void *<code class="descname">json_object_iter_next</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, void<em>&nbsp;*iter</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_next" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an iterator pointing to the next key-value pair in <em>object</em>
after <em>iter</em>, or <em>NULL</em> if the whole object has been iterated
through.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_key">
const char *<code class="descname">json_object_iter_key</code><span class="sig-paren">(</span>void<em>&nbsp;*iter</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the associated key from <em>iter</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_value">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_object_iter_value</code><span class="sig-paren">(</span>void<em>&nbsp;*iter</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_value" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p>Extract the associated value from <em>iter</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_set">
int <code class="descname">json_object_iter_set</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, void<em>&nbsp;*iter</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the value of the key-value pair in <em>object</em>, that is pointed to
by <em>iter</em>, to <em>value</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_iter_set_new">
int <code class="descname">json_object_iter_set_new</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*object</em>, void<em>&nbsp;*iter</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_iter_set_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_iter_set" title="json_object_iter_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_set()</span></code></a>, but steals the reference to
<em>value</em>. This is useful when <em>value</em> is newly created and not used
after the call.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_object_key_to_iter">
void *<code class="descname">json_object_key_to_iter</code><span class="sig-paren">(</span>const char<em>&nbsp;*key</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_key_to_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#c.json_object_iter_at" title="json_object_iter_at"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_at()</span></code></a>, but much faster. Only works for
values returned by <a class="reference internal" href="#c.json_object_iter_key" title="json_object_iter_key"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_key()</span></code></a>. Using other keys
will lead to segfaults. This function is used internally to
implement <a class="reference internal" href="#c.json_object_foreach" title="json_object_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach()</span></code></a>. Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* obj is a JSON object */</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>
<span class="n">json_t</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>

<span class="kt">void</span> <span class="o">*</span><span class="n">iter</span> <span class="o">=</span> <span class="n">json_object_iter</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="n">iter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">json_object_iter_key</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">json_object_iter_value</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
    <span class="cm">/* use key and value ... */</span>
    <span class="n">iter</span> <span class="o">=</span> <span class="n">json_object_iter_next</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">iter</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_object_seed">
void <code class="descname">json_object_seed</code><span class="sig-paren">(</span>size_t<em>&nbsp;seed</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_object_seed" title="Permalink to this definition">¶</a></dt>
<dd><p>Seed the hash function used in Jansson&#8217;s hashtable implementation.
The seed is used to randomize the hash function so that an
attacker cannot control its output.</p>
<p>If <em>seed</em> is 0, Jansson generates the seed itself by reading
random data from the operating system&#8217;s entropy sources. If no
entropy sources are available, falls back to using a combination
of the current timestamp (with microsecond precision if possible)
and the process ID.</p>
<p>If called at all, this function must be called before any calls to
<a class="reference internal" href="#c.json_object" title="json_object"><code class="xref c c-func docutils literal"><span class="pre">json_object()</span></code></a>, either explicit or implicit. If this
function is not called by the user, the first call to
<a class="reference internal" href="#c.json_object" title="json_object"><code class="xref c c-func docutils literal"><span class="pre">json_object()</span></code></a> (either explicit or implicit) seeds the hash
function. See <a class="reference internal" href="index.html#portability-thread-safety"><span>Thread safety</span></a> for notes on thread
safety.</p>
<p>If repeatable results are required, for e.g. unit tests, the hash
function can be &#8220;unrandomized&#8221; by calling <a class="reference internal" href="#c.json_object_seed" title="json_object_seed"><code class="xref c c-func docutils literal"><span class="pre">json_object_seed()</span></code></a>
with a constant value on program startup, e.g.
<code class="docutils literal"><span class="pre">json_object_seed(1)</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="error-reporting">
<h4>Error reporting<a class="headerlink" href="#error-reporting" title="Permalink to this headline">¶</a></h4>
<p>Jansson uses a single struct type to pass error information to the
user. See sections <a class="reference internal" href="#apiref-decoding"><span>Decoding</span></a>, <a class="reference internal" href="#apiref-pack"><span>Building Values</span></a> and
<a class="reference internal" href="#apiref-unpack"><span>Parsing and Validating Values</span></a> for functions that pass error information using
this struct.</p>
<dl class="type">
<dt id="c.json_error_t">
<code class="descname">json_error_t</code><a class="headerlink" href="#c.json_error_t" title="Permalink to this definition">¶</a></dt>
<dd><dl class="member">
<dt>
<code class="descname">char text[]</code></dt>
<dd><p>The error message (in UTF-8), or an empty string if a message is
not available.</p>
</dd></dl>

<dl class="member">
<dt>
<code class="descname">char source[]</code></dt>
<dd><p>Source of the error. This can be (a part of) the file name or a
special identifier in angle brackets (e.g. <code class="docutils literal"><span class="pre">&lt;string&gt;</span></code>).</p>
</dd></dl>

<dl class="member">
<dt id="c.json_error_t.line">
int <code class="descname">line</code><a class="headerlink" href="#c.json_error_t.line" title="Permalink to this definition">¶</a></dt>
<dd><p>The line number on which the error occurred.</p>
</dd></dl>

<dl class="member">
<dt id="c.json_error_t.column">
int <code class="descname">column</code><a class="headerlink" href="#c.json_error_t.column" title="Permalink to this definition">¶</a></dt>
<dd><p>The column on which the error occurred. Note that this is the
<em>character column</em>, not the byte column, i.e. a multibyte UTF-8
character counts as one column.</p>
</dd></dl>

<dl class="member">
<dt id="c.json_error_t.position">
int <code class="descname">position</code><a class="headerlink" href="#c.json_error_t.position" title="Permalink to this definition">¶</a></dt>
<dd><p>The position in bytes from the start of the input. This is
useful for debugging Unicode encoding problems.</p>
</dd></dl>

</dd></dl>

<p>The normal use of <a class="reference internal" href="#c.json_error_t" title="json_error_t"><code class="xref c c-type docutils literal"><span class="pre">json_error_t</span></code></a> is to allocate it on the stack,
and pass a pointer to a function. Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">json_t</span> <span class="o">*</span><span class="n">json</span><span class="p">;</span>
    <span class="n">json_error_t</span> <span class="n">error</span><span class="p">;</span>

    <span class="n">json</span> <span class="o">=</span> <span class="n">json_load_file</span><span class="p">(</span><span class="s">&quot;/path/to/file.json&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">json</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* the error variable contains error information */</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also note that if the call succeeded (<code class="docutils literal"><span class="pre">json</span> <span class="pre">!=</span> <span class="pre">NULL</span></code> in the above
example), the contents of <code class="docutils literal"><span class="pre">error</span></code> are generally left unspecified.
The decoding functions write to the <code class="docutils literal"><span class="pre">position</span></code> member also on
success. See <a class="reference internal" href="#apiref-decoding"><span>Decoding</span></a> for more info.</p>
<p>All functions also accept <em>NULL</em> as the <a class="reference internal" href="#c.json_error_t" title="json_error_t"><code class="xref c c-type docutils literal"><span class="pre">json_error_t</span></code></a> pointer,
in which case no error information is returned to the caller.</p>
</div>
<div class="section" id="encoding">
<h4>Encoding<a class="headerlink" href="#encoding" title="Permalink to this headline">¶</a></h4>
<p>This sections describes the functions that can be used to encode
values to JSON. By default, only objects and arrays can be encoded
directly, since they are the only valid <em>root</em> values of a JSON text.
To encode any JSON value, use the <code class="docutils literal"><span class="pre">JSON_ENCODE_ANY</span></code> flag (see
below).</p>
<p>By default, the output has no newlines, and spaces are used between
array and object elements for a readable output. This behavior can be
altered by using the <code class="docutils literal"><span class="pre">JSON_INDENT</span></code> and <code class="docutils literal"><span class="pre">JSON_COMPACT</span></code> flags
described below. A newline is never appended to the end of the encoded
JSON data.</p>
<p>Each function takes a <em>flags</em> parameter that controls some aspects of
how the data is encoded. Its default value is 0. The following macros
can be ORed together to obtain <em>flags</em>.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">JSON_INDENT(n)</span></code></dt>
<dd><p class="first">Pretty-print the result, using newlines between array and object
items, and indenting with <em>n</em> spaces. The valid range for <em>n</em> is
between 0 and 31 (inclusive), other values result in an undefined
output. If <code class="docutils literal"><span class="pre">JSON_INDENT</span></code> is not used or <em>n</em> is 0, no newlines are
inserted between array and object items.</p>
<p>The <code class="docutils literal"><span class="pre">JSON_MAX_INDENT</span></code> constant defines the maximum indentation
that can be used, and its value is 31.</p>
<div class="last versionchanged">
<p><span class="versionmodified">Changed in version 2.7: </span>Added <code class="docutils literal"><span class="pre">JSON_MAX_INDENT</span></code>.</p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_COMPACT</span></code></dt>
<dd>This flag enables a compact representation, i.e. sets the separator
between array and object items to <code class="docutils literal"><span class="pre">&quot;,&quot;</span></code> and between object keys
and values to <code class="docutils literal"><span class="pre">&quot;:&quot;</span></code>. Without this flag, the corresponding
separators are <code class="docutils literal"><span class="pre">&quot;,</span> <span class="pre">&quot;</span></code> and <code class="docutils literal"><span class="pre">&quot;:</span> <span class="pre">&quot;</span></code> for more readable output.</dd>
<dt><code class="docutils literal"><span class="pre">JSON_ENSURE_ASCII</span></code></dt>
<dd>If this flag is used, the output is guaranteed to consist only of
ASCII characters. This is achieved by escaping all Unicode
characters outside the ASCII range.</dd>
<dt><code class="docutils literal"><span class="pre">JSON_SORT_KEYS</span></code></dt>
<dd>If this flag is used, all the objects in output are sorted by key.
This is useful e.g. if two JSON texts are diffed or visually
compared.</dd>
<dt><code class="docutils literal"><span class="pre">JSON_PRESERVE_ORDER</span></code></dt>
<dd><p class="first"><strong>Deprecated since version 2.8:</strong> Order of object keys
is always preserved.</p>
<p class="last">Prior to version 2.8: If this flag is used, object keys in the
output are sorted into the same order in which they were first
inserted to the object. For example, decoding a JSON text and then
encoding with this flag preserves the order of object keys.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_ENCODE_ANY</span></code></dt>
<dd><p class="first">Specifying this flag makes it possible to encode any JSON value on
its own. Without it, only objects and arrays can be passed as the
<em>json</em> value to the encoding functions.</p>
<p><strong>Note:</strong> Encoding any value may be useful in some scenarios, but
it&#8217;s generally discouraged as it violates strict compatibility with
<span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>. If you use this flag, don&#8217;t expect interoperability
with other JSON systems.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_ESCAPE_SLASH</span></code></dt>
<dd><p class="first">Escape the <code class="docutils literal"><span class="pre">/</span></code> characters in strings with <code class="docutils literal"><span class="pre">\/</span></code>.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_REAL_PRECISION(n)</span></code></dt>
<dd><p class="first">Output all real numbers with at most <em>n</em> digits of precision. The
valid range for <em>n</em> is between 0 and 31 (inclusive), and other
values result in an undefined behavior.</p>
<p>By default, the precision is 17, to correctly and losslessly encode
all IEEE 754 double precision floating point numbers.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.7.</span></p>
</div>
</dd>
</dl>
<p>These functions output UTF-8:</p>
<dl class="function">
<dt id="c.json_dumps">
char *<code class="descname">json_dumps</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em>, size_t<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the JSON representation of <em>json</em> as a string, or <em>NULL</em> on
error. <em>flags</em> is described above. The return value must be freed
by the caller using <code class="xref c c-func docutils literal"><span class="pre">free()</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_dumpf">
int <code class="descname">json_dumpf</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em>, FILE<em>&nbsp;*output</em>, size_t<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_dumpf" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the JSON representation of <em>json</em> to the stream <em>output</em>.
<em>flags</em> is described above. Returns 0 on success and -1 on error.
If an error occurs, something may have already been written to
<em>output</em>. In this case, the output is undefined and most likely not
valid JSON.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_dump_file">
int <code class="descname">json_dump_file</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em>, const char<em>&nbsp;*path</em>, size_t<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_dump_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the JSON representation of <em>json</em> to the file <em>path</em>. If
<em>path</em> already exists, it is overwritten. <em>flags</em> is described
above. Returns 0 on success and -1 on error.</p>
</dd></dl>

<dl class="type">
<dt id="c.json_dump_callback_t">
<code class="descname">json_dump_callback_t</code><a class="headerlink" href="#c.json_dump_callback_t" title="Permalink to this definition">¶</a></dt>
<dd><p>A typedef for a function that&#8217;s called by
<a class="reference internal" href="#c.json_dump_callback" title="json_dump_callback"><code class="xref c c-func docutils literal"><span class="pre">json_dump_callback()</span></code></a>:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">json_dump_callback_t</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p><em>buffer</em> points to a buffer containing a chunk of output, <em>size</em> is
the length of the buffer, and <em>data</em> is the corresponding
<a class="reference internal" href="#c.json_dump_callback" title="json_dump_callback"><code class="xref c c-func docutils literal"><span class="pre">json_dump_callback()</span></code></a> argument passed through.</p>
<p>On error, the function should return -1 to stop the encoding
process. On success, it should return 0.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_dump_callback">
int <code class="descname">json_dump_callback</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*json</em>, <a class="reference internal" href="index.html#c.json_dump_callback_t" title="json_dump_callback_t">json_dump_callback_t</a><em>&nbsp;callback</em>, void<em>&nbsp;*data</em>, size_t<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_dump_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Call <em>callback</em> repeatedly, passing a chunk of the JSON
representation of <em>json</em> each time. <em>flags</em> is described above.
Returns 0 on success and -1 on error.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="decoding">
<span id="apiref-decoding"></span><h4>Decoding<a class="headerlink" href="#decoding" title="Permalink to this headline">¶</a></h4>
<p>This sections describes the functions that can be used to decode JSON
text to the Jansson representation of JSON data. The JSON
specification requires that a JSON text is either a serialized array
or object, and this requirement is also enforced with the following
functions. In other words, the top level value in the JSON text being
decoded must be either array or object. To decode any JSON value, use
the <code class="docutils literal"><span class="pre">JSON_DECODE_ANY</span></code> flag (see below).</p>
<p>See <a class="reference internal" href="index.html#rfc-conformance"><span>RFC Conformance</span></a> for a discussion on Jansson&#8217;s conformance
to the JSON specification. It explains many design decisions that
affect especially the behavior of the decoder.</p>
<p>Each function takes a <em>flags</em> parameter that can be used to control
the behavior of the decoder. Its default value is 0. The following
macros can be ORed together to obtain <em>flags</em>.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">JSON_REJECT_DUPLICATES</span></code></dt>
<dd><p class="first">Issue a decoding error if any JSON object in the input text
contains duplicate keys. Without this flag, the value of the last
occurrence of each key ends up in the result. Key equivalence is
checked byte-by-byte, without special Unicode comparison
algorithms.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_DECODE_ANY</span></code></dt>
<dd><p class="first">By default, the decoder expects an array or object as the input.
With this flag enabled, the decoder accepts any valid JSON value.</p>
<p><strong>Note:</strong> Decoding any value may be useful in some scenarios, but
it&#8217;s generally discouraged as it violates strict compatibility with
<span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4627.html"><strong>RFC 4627</strong></a>. If you use this flag, don&#8217;t expect interoperability
with other JSON systems.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code></dt>
<dd><p class="first">By default, the decoder expects that its whole input constitutes a
valid JSON text, and issues an error if there&#8217;s extra data after
the otherwise valid JSON input. With this flag enabled, the decoder
stops after decoding a valid JSON array or object, and thus allows
extra data after the JSON text.</p>
<p>Normally, reading will stop when the last <code class="docutils literal"><span class="pre">]</span></code> or <code class="docutils literal"><span class="pre">}</span></code> in the
JSON input is encountered. If both <code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code> and
<code class="docutils literal"><span class="pre">JSON_DECODE_ANY</span></code> flags are used, the decoder may read one extra
UTF-8 code unit (up to 4 bytes of input). For example, decoding
<code class="docutils literal"><span class="pre">4true</span></code> correctly decodes the integer 4, but also reads the
<code class="docutils literal"><span class="pre">t</span></code>. For this reason, if reading multiple consecutive values that
are not arrays or objects, they should be separated by at least one
whitespace character.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_DECODE_INT_AS_REAL</span></code></dt>
<dd><p class="first">JSON defines only one number type. Jansson distinguishes between
ints and reals. For more information see <a class="reference internal" href="index.html#real-vs-integer"><span>Real vs. Integer</span></a>.
With this flag enabled the decoder interprets all numbers as real
values. Integers that do not have an exact double representation
will silently result in a loss of precision. Integers that cause
a double overflow will cause an error.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">JSON_ALLOW_NUL</span></code></dt>
<dd><p class="first">Allow <code class="docutils literal"><span class="pre">\u0000</span></code> escape inside string values. This is a safety
measure; If you know your input can contain null bytes, use this
flag. If you don&#8217;t use this flag, you don&#8217;t have to worry about null
bytes inside strings unless you explicitly create themselves by
using e.g. <a class="reference internal" href="#c.json_stringn" title="json_stringn"><code class="xref c c-func docutils literal"><span class="pre">json_stringn()</span></code></a> or <code class="docutils literal"><span class="pre">s#</span></code> format specifier for
<a class="reference internal" href="#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a>.</p>
<p>Object keys cannot have embedded null bytes even if this flag is
used.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
</dd>
</dl>
<p>Each function also takes an optional <a class="reference internal" href="#c.json_error_t" title="json_error_t"><code class="xref c c-type docutils literal"><span class="pre">json_error_t</span></code></a> parameter
that is filled with error information if decoding fails. It&#8217;s also
updated on success; the number of bytes of input read is written to
its <code class="docutils literal"><span class="pre">position</span></code> field. This is especially useful when using
<code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code> to read multiple consecutive JSON texts.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3: </span>Number of bytes of input read is written to the <code class="docutils literal"><span class="pre">position</span></code> field
of the <a class="reference internal" href="#c.json_error_t" title="json_error_t"><code class="xref c c-type docutils literal"><span class="pre">json_error_t</span></code></a> structure.</p>
</div>
<p>If no error or position information is needed, you can pass <em>NULL</em>.</p>
<dl class="function">
<dt id="c.json_loads">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_loads</code><span class="sig-paren">(</span>const char<em>&nbsp;*input</em>, size_t<em>&nbsp;flags</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_loads" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Decodes the JSON string <em>input</em> and returns the array or object it
contains, or <em>NULL</em> on error, in which case <em>error</em> is filled with
information about the error. <em>flags</em> is described above.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_loadb">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_loadb</code><span class="sig-paren">(</span>const char<em>&nbsp;*buffer</em>, size_t<em>&nbsp;buflen</em>, size_t<em>&nbsp;flags</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_loadb" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Decodes the JSON string <em>buffer</em>, whose length is <em>buflen</em>, and
returns the array or object it contains, or <em>NULL</em> on error, in
which case <em>error</em> is filled with information about the error. This
is similar to <a class="reference internal" href="#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a> except that the string doesn&#8217;t
need to be null-terminated. <em>flags</em> is described above.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_loadf">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_loadf</code><span class="sig-paren">(</span>FILE<em>&nbsp;*input</em>, size_t<em>&nbsp;flags</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_loadf" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Decodes the JSON text in stream <em>input</em> and returns the array or
object it contains, or <em>NULL</em> on error, in which case <em>error</em> is
filled with information about the error. <em>flags</em> is described
above.</p>
<p>This function will start reading the input from whatever position
the input file was, without attempting to seek first. If an error
occurs, the file position will be left indeterminate. On success,
the file position will be at EOF, unless <code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code>
flag was used. In this case, the file position will be at the first
character after the last <code class="docutils literal"><span class="pre">]</span></code> or <code class="docutils literal"><span class="pre">}</span></code> in the JSON input. This
allows calling <a class="reference internal" href="#c.json_loadf" title="json_loadf"><code class="xref c c-func docutils literal"><span class="pre">json_loadf()</span></code></a> on the same <code class="docutils literal"><span class="pre">FILE</span></code> object
multiple times, if the input consists of consecutive JSON texts,
possibly separated by whitespace.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_load_file">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_load_file</code><span class="sig-paren">(</span>const char<em>&nbsp;*path</em>, size_t<em>&nbsp;flags</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_load_file" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Decodes the JSON text in file <em>path</em> and returns the array or
object it contains, or <em>NULL</em> on error, in which case <em>error</em> is
filled with information about the error. <em>flags</em> is described
above.</p>
</dd></dl>

<dl class="type">
<dt id="c.json_load_callback_t">
<code class="descname">json_load_callback_t</code><a class="headerlink" href="#c.json_load_callback_t" title="Permalink to this definition">¶</a></dt>
<dd><p>A typedef for a function that&#8217;s called by
<a class="reference internal" href="#c.json_load_callback" title="json_load_callback"><code class="xref c c-func docutils literal"><span class="pre">json_load_callback()</span></code></a> to read a chunk of input data:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">size_t</span> <span class="p">(</span><span class="o">*</span><span class="n">json_load_callback_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buflen</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p><em>buffer</em> points to a buffer of <em>buflen</em> bytes, and <em>data</em> is the
corresponding <a class="reference internal" href="#c.json_load_callback" title="json_load_callback"><code class="xref c c-func docutils literal"><span class="pre">json_load_callback()</span></code></a> argument passed through.</p>
<p>On success, the function should return the number of bytes read; a
returned value of 0 indicates that no data was read and that the
end of file has been reached. On error, the function should return
<code class="docutils literal"><span class="pre">(size_t)-1</span></code> to abort the decoding process.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_load_callback">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_load_callback</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_load_callback_t" title="json_load_callback_t">json_load_callback_t</a><em>&nbsp;callback</em>, void<em>&nbsp;*data</em>, size_t<em>&nbsp;flags</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_load_callback" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Decodes the JSON text produced by repeated calls to <em>callback</em>, and
returns the array or object it contains, or <em>NULL</em> on error, in
which case <em>error</em> is filled with information about the error.
<em>data</em> is passed through to <em>callback</em> on each call. <em>flags</em> is
described above.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.4.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="building-values">
<span id="apiref-pack"></span><h4>Building Values<a class="headerlink" href="#building-values" title="Permalink to this headline">¶</a></h4>
<p>This section describes functions that help to create, or <em>pack</em>,
complex JSON values, especially nested objects and arrays. Value
building is based on a <em>format string</em> that is used to tell the
functions about the expected arguments.</p>
<p>For example, the format string <code class="docutils literal"><span class="pre">&quot;i&quot;</span></code> specifies a single integer
value, while the format string <code class="docutils literal"><span class="pre">&quot;[ssb]&quot;</span></code> or the equivalent <code class="docutils literal"><span class="pre">&quot;[s,</span> <span class="pre">s,</span>
<span class="pre">b]&quot;</span></code> specifies an array value with two strings and a boolean as its
items:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* Create the JSON integer 42 */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>

<span class="cm">/* Create the JSON array [&quot;foo&quot;, &quot;bar&quot;, true] */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;[ssb]&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Here&#8217;s the full list of format specifiers. The type in parentheses
denotes the resulting JSON type, and the type in brackets (if any)
denotes the C type that is expected as the corresponding argument or
arguments.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">s</span></code> (string) [const char *]</dt>
<dd>Convert a null terminated UTF-8 string to a JSON string.</dd>
<dt><code class="docutils literal"><span class="pre">s?</span></code> (string) [const char *]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">s</span></code>, but if the argument is <em>NULL</em>, output a JSON null
value.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.8.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">s#</span></code> (string) [const char *, int]</dt>
<dd><p class="first">Convert a UTF-8 buffer of a given length to a JSON string.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">s%</span></code> (string) [const char *, size_t]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">s#</span></code> but the length argument is of type <code class="xref c c-type docutils literal"><span class="pre">size_t</span></code>.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">+</span></code> [const char *]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">s</span></code>, but concatenate to the previous string. Only valid
after <code class="docutils literal"><span class="pre">s</span></code>, <code class="docutils literal"><span class="pre">s#</span></code>, <code class="docutils literal"><span class="pre">+</span></code> or <code class="docutils literal"><span class="pre">+#</span></code>.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">+#</span></code> [const char *, int]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">s#</span></code>, but concatenate to the previous string. Only valid
after <code class="docutils literal"><span class="pre">s</span></code>, <code class="docutils literal"><span class="pre">s#</span></code>, <code class="docutils literal"><span class="pre">+</span></code> or <code class="docutils literal"><span class="pre">+#</span></code>.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">+%</span></code> (string) [const char *, size_t]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">+#</span></code> but the length argument is of type <code class="xref c c-type docutils literal"><span class="pre">size_t</span></code>.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">n</span></code> (null)</dt>
<dd>Output a JSON null value. No argument is consumed.</dd>
<dt><code class="docutils literal"><span class="pre">b</span></code> (boolean) [int]</dt>
<dd>Convert a C <code class="xref c c-type docutils literal"><span class="pre">int</span></code> to JSON boolean value. Zero is converted
to <code class="docutils literal"><span class="pre">false</span></code> and non-zero to <code class="docutils literal"><span class="pre">true</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">i</span></code> (integer) [int]</dt>
<dd>Convert a C <code class="xref c c-type docutils literal"><span class="pre">int</span></code> to JSON integer.</dd>
<dt><code class="docutils literal"><span class="pre">I</span></code> (integer) [json_int_t]</dt>
<dd>Convert a C <a class="reference internal" href="#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a> to JSON integer.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code> (real) [double]</dt>
<dd>Convert a C <code class="xref c c-type docutils literal"><span class="pre">double</span></code> to JSON real.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code> (any value) [json_t *]</dt>
<dd>Output any given JSON value as-is. If the value is added to an
array or object, the reference to the value passed to <code class="docutils literal"><span class="pre">o</span></code> is
stolen by the container.</dd>
<dt><code class="docutils literal"><span class="pre">O</span></code> (any value) [json_t *]</dt>
<dd>Like <code class="docutils literal"><span class="pre">o</span></code>, but the argument&#8217;s reference count is incremented.
This is useful if you pack into an array or object and want to
keep the reference for the JSON value consumed by <code class="docutils literal"><span class="pre">O</span></code> to
yourself.</dd>
<dt><code class="docutils literal"><span class="pre">o?</span></code>, <code class="docutils literal"><span class="pre">O?</span></code> (any value) [json_t *]</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">o</span></code> and <code class="docutils literal"><span class="pre">O?</span></code>, respectively, but if the argument is
<em>NULL</em>, output a JSON null value.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.8.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">[fmt]</span></code> (array)</dt>
<dd>Build an array with contents from the inner format string. <code class="docutils literal"><span class="pre">fmt</span></code>
may contain objects and arrays, i.e. recursive value building is
supported.</dd>
<dt><code class="docutils literal"><span class="pre">{fmt}</span></code> (object)</dt>
<dd>Build an object with contents from the inner format string
<code class="docutils literal"><span class="pre">fmt</span></code>. The first, third, etc. format specifier represent a key,
and must be a string (see <code class="docutils literal"><span class="pre">s</span></code>, <code class="docutils literal"><span class="pre">s#</span></code>, <code class="docutils literal"><span class="pre">+</span></code> and <code class="docutils literal"><span class="pre">+#</span></code> above),
as object keys are always strings. The second, fourth, etc. format
specifier represent a value. Any value may be an object or array,
i.e. recursive value building is supported.</dd>
</dl>
<p>Whitespace, <code class="docutils literal"><span class="pre">:</span></code> and <code class="docutils literal"><span class="pre">,</span></code> are ignored.</p>
<dl class="function">
<dt id="c.json_pack">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_pack</code><span class="sig-paren">(</span>const char<em>&nbsp;*fmt</em>, ...<span class="sig-paren">)</span><a class="headerlink" href="#c.json_pack" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Build a new JSON value according to the format string <em>fmt</em>. For
each format specifier (except for <code class="docutils literal"><span class="pre">{}[]n</span></code>), one or more arguments
are consumed and used to build the corresponding value. Returns
<em>NULL</em> on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_pack_ex">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_pack_ex</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em>, size_t<em>&nbsp;flags</em>, const char<em>&nbsp;*fmt</em>, ...<span class="sig-paren">)</span><a class="headerlink" href="#c.json_pack_ex" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_vpack_ex">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_vpack_ex</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em>, size_t<em>&nbsp;flags</em>, const char<em>&nbsp;*fmt</em>, va_list<em>&nbsp;ap</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_vpack_ex" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Like <a class="reference internal" href="#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a>, but an in the case of an error, an error
message is written to <em>error</em>, if it&#8217;s not <em>NULL</em>. The <em>flags</em>
parameter is currently unused and should be set to 0.</p>
<p>As only the errors in format string (and out-of-memory errors) can
be caught by the packer, these two functions are most likely only
useful for debugging format strings.</p>
</dd></dl>

<p>More examples:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* Build an empty JSON object */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">);</span>

<span class="cm">/* Build the JSON object {&quot;foo&quot;: 42, &quot;bar&quot;: 7} */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;{sisi}&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="cm">/* Like above, &#39;:&#39;, &#39;,&#39; and whitespace are ignored */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;{s:i, s:i}&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="cm">/* Build the JSON array [[1, 2], {&quot;cool&quot;: true}] */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;[[i,i],{s:b}]&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;cool&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cm">/* Build a string from a non-null terminated buffer */</span>
<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">&#39;t&#39;</span><span class="p">,</span> <span class="sc">&#39;e&#39;</span><span class="p">,</span> <span class="sc">&#39;s&#39;</span><span class="p">,</span> <span class="sc">&#39;t&#39;</span><span class="p">};</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;s#&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="cm">/* Concatenate strings together to build the JSON string &quot;foobarbaz&quot; */</span>
<span class="n">json_pack</span><span class="p">(</span><span class="s">&quot;s++&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-and-validating-values">
<span id="apiref-unpack"></span><h4>Parsing and Validating Values<a class="headerlink" href="#parsing-and-validating-values" title="Permalink to this headline">¶</a></h4>
<p>This section describes functions that help to validate complex values
and extract, or <em>unpack</em>, data from them. Like <a class="reference internal" href="#apiref-pack"><span>building values</span></a>, this is also based on format strings.</p>
<p>While a JSON value is unpacked, the type specified in the format
string is checked to match that of the JSON value. This is the
validation part of the process. In addition to this, the unpacking
functions can also check that all items of arrays and objects are
unpacked. This check be enabled with the format specifier <code class="docutils literal"><span class="pre">!</span></code> or by
using the flag <code class="docutils literal"><span class="pre">JSON_STRICT</span></code>. See below for details.</p>
<p>Here&#8217;s the full list of format specifiers. The type in parentheses
denotes the JSON type, and the type in brackets (if any) denotes the C
type whose address should be passed.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">s</span></code> (string) [const char *]</dt>
<dd>Convert a JSON string to a pointer to a null terminated UTF-8
string. The resulting string is extracted by using
<a class="reference internal" href="#c.json_string_value" title="json_string_value"><code class="xref c c-func docutils literal"><span class="pre">json_string_value()</span></code></a> internally, so it exists as long as
there are still references to the corresponding JSON string.</dd>
<dt><code class="docutils literal"><span class="pre">s%</span></code> (string) [const char *, size_t *]</dt>
<dd><p class="first">Convert a JSON string to a pointer to a null terminated UTF-8
string and its length.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.6.</span></p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">n</span></code> (null)</dt>
<dd>Expect a JSON null value. Nothing is extracted.</dd>
<dt><code class="docutils literal"><span class="pre">b</span></code> (boolean) [int]</dt>
<dd>Convert a JSON boolean value to a C <code class="xref c c-type docutils literal"><span class="pre">int</span></code>, so that <code class="docutils literal"><span class="pre">true</span></code>
is converted to 1 and <code class="docutils literal"><span class="pre">false</span></code> to 0.</dd>
<dt><code class="docutils literal"><span class="pre">i</span></code> (integer) [int]</dt>
<dd>Convert a JSON integer to C <code class="xref c c-type docutils literal"><span class="pre">int</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">I</span></code> (integer) [json_int_t]</dt>
<dd>Convert a JSON integer to C <a class="reference internal" href="#c.json_int_t" title="json_int_t"><code class="xref c c-type docutils literal"><span class="pre">json_int_t</span></code></a>.</dd>
<dt><code class="docutils literal"><span class="pre">f</span></code> (real) [double]</dt>
<dd>Convert a JSON real to C <code class="xref c c-type docutils literal"><span class="pre">double</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">F</span></code> (integer or real) [double]</dt>
<dd>Convert a JSON number (integer or real) to C <code class="xref c c-type docutils literal"><span class="pre">double</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">o</span></code> (any value) [json_t *]</dt>
<dd>Store a JSON value with no conversion to a <a class="reference internal" href="#c.json_t" title="json_t"><code class="xref c c-type docutils literal"><span class="pre">json_t</span></code></a> pointer.</dd>
<dt><code class="docutils literal"><span class="pre">O</span></code> (any value) [json_t *]</dt>
<dd>Like <code class="docutils literal"><span class="pre">O</span></code>, but the JSON value&#8217;s reference count is incremented.</dd>
<dt><code class="docutils literal"><span class="pre">[fmt]</span></code> (array)</dt>
<dd>Convert each item in the JSON array according to the inner format
string. <code class="docutils literal"><span class="pre">fmt</span></code> may contain objects and arrays, i.e. recursive
value extraction is supported.</dd>
<dt><code class="docutils literal"><span class="pre">{fmt}</span></code> (object)</dt>
<dd><p class="first">Convert each item in the JSON object according to the inner format
string <code class="docutils literal"><span class="pre">fmt</span></code>. The first, third, etc. format specifier represent
a key, and must be <code class="docutils literal"><span class="pre">s</span></code>. The corresponding argument to unpack
functions is read as the object key. The second fourth, etc.
format specifier represent a value and is written to the address
given as the corresponding argument. <strong>Note</strong> that every other
argument is read from and every other is written to.</p>
<p><code class="docutils literal"><span class="pre">fmt</span></code> may contain objects and arrays as values, i.e. recursive
value extraction is supported.</p>
<div class="last versionadded">
<p><span class="versionmodified">New in version 2.3: </span>Any <code class="docutils literal"><span class="pre">s</span></code> representing a key may be suffixed with a <code class="docutils literal"><span class="pre">?</span></code> to
make the key optional. If the key is not found, nothing is
extracted. See below for an example.</p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">!</span></code></dt>
<dd>This special format specifier is used to enable the check that
all object and array items are accessed, on a per-value basis. It
must appear inside an array or object as the last format specifier
before the closing bracket or brace. To enable the check globally,
use the <code class="docutils literal"><span class="pre">JSON_STRICT</span></code> unpacking flag.</dd>
<dt><code class="docutils literal"><span class="pre">*</span></code></dt>
<dd>This special format specifier is the opposite of <code class="docutils literal"><span class="pre">!</span></code>. If the
<code class="docutils literal"><span class="pre">JSON_STRICT</span></code> flag is used, <code class="docutils literal"><span class="pre">*</span></code> can be used to disable the
strict check on a per-value basis. It must appear inside an array
or object as the last format specifier before the closing bracket
or brace.</dd>
</dl>
<p>Whitespace, <code class="docutils literal"><span class="pre">:</span></code> and <code class="docutils literal"><span class="pre">,</span></code> are ignored.</p>
<dl class="function">
<dt id="c.json_unpack">
int <code class="descname">json_unpack</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*root</em>, const char<em>&nbsp;*fmt</em>, ...<span class="sig-paren">)</span><a class="headerlink" href="#c.json_unpack" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate and unpack the JSON value <em>root</em> according to the format
string <em>fmt</em>. Returns 0 on success and -1 on failure.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_unpack_ex">
int <code class="descname">json_unpack_ex</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*root</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em>, size_t<em>&nbsp;flags</em>, const char<em>&nbsp;*fmt</em>, ...<span class="sig-paren">)</span><a class="headerlink" href="#c.json_unpack_ex" title="Permalink to this definition">¶</a></dt>
<dt id="c.json_vunpack_ex">
int <code class="descname">json_vunpack_ex</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*root</em>, <a class="reference internal" href="index.html#c.json_error_t" title="json_error_t">json_error_t</a><em>&nbsp;*error</em>, size_t<em>&nbsp;flags</em>, const char<em>&nbsp;*fmt</em>, va_list<em>&nbsp;ap</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_vunpack_ex" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate and unpack the JSON value <em>root</em> according to the format
string <em>fmt</em>. If an error occurs and <em>error</em> is not <em>NULL</em>, write
error information to <em>error</em>. <em>flags</em> can be used to control the
behaviour of the unpacker, see below for the flags. Returns 0 on
success and -1 on failure.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The first argument of all unpack functions is <code class="docutils literal"><span class="pre">json_t</span> <span class="pre">*root</span></code>
instead of <code class="docutils literal"><span class="pre">const</span> <span class="pre">json_t</span> <span class="pre">*root</span></code>, because the use of <code class="docutils literal"><span class="pre">O</span></code> format
specifier causes the reference count of <code class="docutils literal"><span class="pre">root</span></code>, or some value
reachable from <code class="docutils literal"><span class="pre">root</span></code>, to be increased. Furthermore, the <code class="docutils literal"><span class="pre">o</span></code>
format specifier may be used to extract a value as-is, which allows
modifying the structure or contents of a value reachable from
<code class="docutils literal"><span class="pre">root</span></code>.</p>
<p class="last">If the <code class="docutils literal"><span class="pre">O</span></code> and <code class="docutils literal"><span class="pre">o</span></code> format specifiers are not used, it&#8217;s
perfectly safe to cast a <code class="docutils literal"><span class="pre">const</span> <span class="pre">json_t</span> <span class="pre">*</span></code> variable to plain
<code class="docutils literal"><span class="pre">json_t</span> <span class="pre">*</span></code> when used with these functions.</p>
</div>
<p>The following unpacking flags are available:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">JSON_STRICT</span></code></dt>
<dd>Enable the extra validation step checking that all object and
array items are unpacked. This is equivalent to appending the
format specifier <code class="docutils literal"><span class="pre">!</span></code> to the end of every array and object in the
format string.</dd>
<dt><code class="docutils literal"><span class="pre">JSON_VALIDATE_ONLY</span></code></dt>
<dd>Don&#8217;t extract any data, just validate the JSON value against the
given format string. Note that object keys must still be specified
after the format string.</dd>
</dl>
<p>Examples:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* root is the JSON integer 42 */</span>
<span class="kt">int</span> <span class="n">myint</span><span class="p">;</span>
<span class="n">json_unpack</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">myint</span> <span class="o">==</span> <span class="mi">42</span><span class="p">);</span>

<span class="cm">/* root is the JSON object {&quot;foo&quot;: &quot;bar&quot;, &quot;quux&quot;: true} */</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">boolean</span><span class="p">;</span>
<span class="n">json_unpack</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;{s:s, s:b}&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">,</span> <span class="s">&quot;quux&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">boolean</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">boolean</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>

<span class="cm">/* root is the JSON array [[1, 2], {&quot;baz&quot;: null} */</span>
<span class="n">json_error_t</span> <span class="n">error</span><span class="p">;</span>
<span class="n">json_unpack_ex</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">,</span> <span class="n">JSON_VALIDATE_ONLY</span><span class="p">,</span> <span class="s">&quot;[[i,i], {s:n}]&quot;</span><span class="p">,</span> <span class="s">&quot;baz&quot;</span><span class="p">);</span>
<span class="cm">/* returns 0 for validation success, nothing is extracted */</span>

<span class="cm">/* root is the JSON array [1, 2, 3, 4, 5] */</span>
<span class="kt">int</span> <span class="n">myint1</span><span class="p">,</span> <span class="n">myint2</span><span class="p">;</span>
<span class="n">json_unpack</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;[ii!]&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint2</span><span class="p">);</span>
<span class="cm">/* returns -1 for failed validation */</span>

<span class="cm">/* root is an empty JSON object */</span>
<span class="kt">int</span> <span class="n">myint</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">myint2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">myint3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">json_unpack</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s">&quot;{s?i, s?[ii]}&quot;</span><span class="p">,</span>
            <span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint1</span><span class="p">,</span>
            <span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myint3</span><span class="p">);</span>
<span class="cm">/* myint1, myint2 or myint3 is no touched as &quot;foo&quot; and &quot;bar&quot; don&#39;t exist */</span>
</pre></div>
</div>
</div>
<div class="section" id="equality">
<h4>Equality<a class="headerlink" href="#equality" title="Permalink to this headline">¶</a></h4>
<p>Testing for equality of two JSON values cannot, in general, be
achieved using the <code class="docutils literal"><span class="pre">==</span></code> operator. Equality in the terms of the
<code class="docutils literal"><span class="pre">==</span></code> operator states that the two <a class="reference internal" href="#c.json_t" title="json_t"><code class="xref c c-type docutils literal"><span class="pre">json_t</span></code></a> pointers point to
exactly the same JSON value. However, two JSON values can be equal not
only if they are exactly the same value, but also if they have equal
&#8220;contents&#8221;:</p>
<ul class="simple">
<li>Two integer or real values are equal if their contained numeric
values are equal. An integer value is never equal to a real value,
though.</li>
<li>Two strings are equal if their contained UTF-8 strings are equal,
byte by byte. Unicode comparison algorithms are not implemented.</li>
<li>Two arrays are equal if they have the same number of elements and
each element in the first array is equal to the corresponding
element in the second array.</li>
<li>Two objects are equal if they have exactly the same keys and the
value for each key in the first object is equal to the value of the
corresponding key in the second object.</li>
<li>Two true, false or null values have no &#8220;contents&#8221;, so they are equal
if their types are equal. (Because these values are singletons,
their equality can actually be tested with <code class="docutils literal"><span class="pre">==</span></code>.)</li>
</ul>
<dl class="function">
<dt id="c.json_equal">
int <code class="descname">json_equal</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value1</em>, <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value2</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_equal" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns 1 if <em>value1</em> and <em>value2</em> are equal, as defined above.
Returns 0 if they are unequal or one or both of the pointers are
<em>NULL</em>.</p>
</dd></dl>

</div>
<div class="section" id="copying">
<h4>Copying<a class="headerlink" href="#copying" title="Permalink to this headline">¶</a></h4>
<p>Because of reference counting, passing JSON values around doesn&#8217;t
require copying them. But sometimes a fresh copy of a JSON value is
needed. For example, if you need to modify an array, but still want to
use the original afterwards, you should take a copy of it first.</p>
<p>Jansson supports two kinds of copying: shallow and deep. There is a
difference between these methods only for arrays and objects. Shallow
copying only copies the first level value (array or object) and uses
the same child values in the copied value. Deep copying makes a fresh
copy of the child values, too. Moreover, all the child values are deep
copied in a recursive fashion.</p>
<p>Copying objects preserves the insertion order of keys.</p>
<dl class="function">
<dt id="c.json_copy">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_copy</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_copy" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a shallow copy of <em>value</em>, or <em>NULL</em> on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_deep_copy">
<a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a> *<code class="descname">json_deep_copy</code><span class="sig-paren">(</span>const <a class="reference internal" href="index.html#c.json_t" title="json_t">json_t</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_deep_copy" title="Permalink to this definition">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>Returns a deep copy of <em>value</em>, or <em>NULL</em> on error.</p>
</dd></dl>

</div>
<div class="section" id="custom-memory-allocation">
<span id="apiref-custom-memory-allocation"></span><h4>Custom Memory Allocation<a class="headerlink" href="#custom-memory-allocation" title="Permalink to this headline">¶</a></h4>
<p>By default, Jansson uses <code class="xref c c-func docutils literal"><span class="pre">malloc()</span></code> and <code class="xref c c-func docutils literal"><span class="pre">free()</span></code> for
memory allocation. These functions can be overridden if custom
behavior is needed.</p>
<dl class="type">
<dt id="c.json_malloc_t">
<code class="descname">json_malloc_t</code><a class="headerlink" href="#c.json_malloc_t" title="Permalink to this definition">¶</a></dt>
<dd><p>A typedef for a function pointer with <code class="xref c c-func docutils literal"><span class="pre">malloc()</span></code>&#8216;s
signature:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">json_malloc_t</span><span class="p">)(</span><span class="kt">size_t</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="type">
<dt id="c.json_free_t">
<code class="descname">json_free_t</code><a class="headerlink" href="#c.json_free_t" title="Permalink to this definition">¶</a></dt>
<dd><p>A typedef for a function pointer with <code class="xref c c-func docutils literal"><span class="pre">free()</span></code>&#8216;s
signature:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">json_free_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.json_set_alloc_funcs">
void <code class="descname">json_set_alloc_funcs</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_malloc_t" title="json_malloc_t">json_malloc_t</a><em>&nbsp;malloc_fn</em>, <a class="reference internal" href="index.html#c.json_free_t" title="json_free_t">json_free_t</a><em>&nbsp;free_fn</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_set_alloc_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Use <em>malloc_fn</em> instead of <code class="xref c c-func docutils literal"><span class="pre">malloc()</span></code> and <em>free_fn</em> instead
of <code class="xref c c-func docutils literal"><span class="pre">free()</span></code>. This function has to be called before any other
Jansson&#8217;s API functions to ensure that all memory operations use
the same functions.</p>
</dd></dl>

<dl class="function">
<dt id="c.json_get_alloc_funcs">
void <code class="descname">json_get_alloc_funcs</code><span class="sig-paren">(</span><a class="reference internal" href="index.html#c.json_malloc_t" title="json_malloc_t">json_malloc_t</a><em>&nbsp;*malloc_fn</em>, <a class="reference internal" href="index.html#c.json_free_t" title="json_free_t">json_free_t</a><em>&nbsp;*free_fn</em><span class="sig-paren">)</span><a class="headerlink" href="#c.json_get_alloc_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the current malloc_fn and free_fn used. Either parameter
may be NULL.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.8.</span></p>
</div>
</dd></dl>

<p><strong>Examples:</strong></p>
<p>Circumvent problems with different CRT heaps on Windows by using
application&#8217;s <code class="xref c c-func docutils literal"><span class="pre">malloc()</span></code> and <code class="xref c c-func docutils literal"><span class="pre">free()</span></code>:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_set_alloc_funcs</span><span class="p">(</span><span class="n">malloc</span><span class="p">,</span> <span class="n">free</span><span class="p">);</span>
</pre></div>
</div>
<p>Use the <a class="reference external" href="http://www.hboehm.info/gc/">Boehm&#8217;s conservative garbage collector</a> for memory
operations:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">json_set_alloc_funcs</span><span class="p">(</span><span class="n">GC_malloc</span><span class="p">,</span> <span class="n">GC_free</span><span class="p">);</span>
</pre></div>
</div>
<p>Allow storing sensitive data (e.g. passwords or encryption keys) in
JSON structures by zeroing all memory when freed:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">secure_malloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* Store the memory area size in the beginning of the block */</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
    <span class="o">*</span><span class="p">((</span><span class="kt">size_t</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">)</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ptr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">secure_free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>

    <span class="n">ptr</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">size_t</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">);</span>

    <span class="n">guaranteed_memset</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">json_set_alloc_funcs</span><span class="p">(</span><span class="n">secure_malloc</span><span class="p">,</span> <span class="n">secure_free</span><span class="p">);</span>
    <span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about the issues of storing sensitive data in
memory, see
<a class="reference external" href="http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/protect-secrets.html">http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/protect-secrets.html</a>.
The page also explains the <code class="xref c c-func docutils literal"><span class="pre">guaranteed_memset()</span></code> function used
in the example and gives a sample implementation for it.</p>
</div>
</div>
<span id="document-changes"></span><div class="section" id="changes-in-jansson">
<h3>Changes in Jansson<a class="headerlink" href="#changes-in-jansson" title="Permalink to this headline">¶</a></h3>
<div class="section" id="version-2-9">
<h4>Version 2.9<a class="headerlink" href="#version-2-9" title="Permalink to this headline">¶</a></h4>
<p>Released 2016-09-18</p>
<ul class="simple">
<li>New features:<ul>
<li>Add <code class="docutils literal"><span class="pre">json_auto_t</span></code> to automatically decref a value that goes out
of scope. Available only on GCC and Clang. (#301)</li>
</ul>
</li>
<li>Build:<ul>
<li>Fix CMake build (at least on Linux) by removing conflicting
jansson_config.h from the distribution (#306)</li>
<li>Change CMake install target generation to be optional (#305)</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Small documentation fixes.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-8">
<h4>Version 2.8<a class="headerlink" href="#version-2-8" title="Permalink to this headline">¶</a></h4>
<p>Released 2016-08-30</p>
<ul class="simple">
<li>New features:<ul>
<li>Always preserve insertion order of object items.
<a class="reference internal" href="index.html#c.json_object_iter" title="json_object_iter"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter()</span></code></a> and friends, <a class="reference internal" href="index.html#c.json_object_foreach" title="json_object_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach()</span></code></a> and
<a class="reference internal" href="index.html#c.json_dumps" title="json_dumps"><code class="xref c c-func docutils literal"><span class="pre">json_dumps()</span></code></a> and friends now always work in the insertion order of
object items (#293).</li>
<li>Add <a class="reference internal" href="index.html#c.json_object_foreach_safe" title="json_object_foreach_safe"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach_safe()</span></code></a> macro that allows
<a class="reference internal" href="index.html#c.json_object_del" title="json_object_del"><code class="xref c c-func docutils literal"><span class="pre">json_object_del()</span></code></a> calls during iteration (#230).</li>
<li>Add <a class="reference internal" href="index.html#c.json_get_alloc_funcs" title="json_get_alloc_funcs"><code class="xref c c-func docutils literal"><span class="pre">json_get_alloc_funcs()</span></code></a> to allow reading the allocation
functions set by <a class="reference internal" href="index.html#c.json_set_alloc_funcs" title="json_set_alloc_funcs"><code class="xref c c-func docutils literal"><span class="pre">json_set_alloc_funcs()</span></code></a> (#262, #264).</li>
<li>Add <a class="reference internal" href="index.html#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a> format specifiers s?, o? and O? for values that
can be null (#261, #270).</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Fix a crash when parsing inputs consisting of very deeply nested
arrays or objects (#282, #284).</li>
<li>Never convert numbers to integers in the parser when
JSON_DECODE_INT_AS_REAL is set. This fixes error messages for
overflowing numbers when JSON_DECODE_INT_AS_REAL is set (#212).</li>
<li>Fix a use-after-free in <a class="reference internal" href="index.html#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a> error handling.</li>
<li>Fix subnormal number parsing on mingw32.</li>
<li>Handle out-of-memory situations gracefully in the hashtable
implementation (#298).</li>
</ul>
</li>
<li>Build:<ul>
<li>Fix build with CMake on all versions of Visual Studio up to 2015
(#262, #289).</li>
<li>Fix pkgconfig libdir when using CMake (#268).</li>
<li>Fix CMake config for static CRT builds on Windows (#206).</li>
<li>Fix warnings on LLVM 6.0 targeting iOS arm64 (#208).</li>
<li>Add coverlls.io support via Travis for a nice test coverage badge
(#211).</li>
<li>Don&#8217;t expect <code class="docutils literal"><span class="pre">jansson_config.h</span></code> to be in the compiler&#8217;s include
path (#209).</li>
<li>Add a build-time option to set initial hashtable size (#213).</li>
<li>Use snprintf and strncpy in place of sprintf and strcpy to silence
linker warnings on OpenBSD (#233).</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Fix various typos in documentation, and a broken link (#258).</li>
<li>Add an example program in <code class="docutils literal"><span class="pre">examples/</span></code> (#214, #217).</li>
<li>Fix building of documentation man pages (#207).</li>
<li>Document the fact that copying objects doesn&#8217;t preserve the
insertion order of keys (#237).</li>
</ul>
</li>
<li>Tests:<ul>
<li>Don&#8217;t use the nonstandard __FUNCTION__ macro in tests.</li>
<li>Use expr instead of $((...)) in shell scripts for Solaris 10
compatibility.</li>
<li>Disable Visual Studio warning C4756 when triggered deliberately in
tests (#216).</li>
<li>Other minor fixes (#221, #248).</li>
</ul>
</li>
<li>Other changes:<ul>
<li>List all unrecognized object keys when strict unpacking fails
(#263).</li>
<li>Alter the order of the members of the hashtable_pair struct for
easier debugging.</li>
<li>Minor performance improvement to <code class="xref c c-func docutils literal"><span class="pre">json_dump()</span></code> and friends (#234).</li>
<li>Minor style fixes (#255, #257).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-7">
<h4>Version 2.7<a class="headerlink" href="#version-2-7" title="Permalink to this headline">¶</a></h4>
<p>Released 2014-10-02</p>
<ul class="simple">
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a> and friends: Add format specifiers <code class="docutils literal"><span class="pre">s%</span></code> and <code class="docutils literal"><span class="pre">+%</span></code>
for a size_t string length (#141).</li>
<li><a class="reference internal" href="index.html#c.json_unpack" title="json_unpack"><code class="xref c c-func docutils literal"><span class="pre">json_unpack()</span></code></a> and friends: Add format specifier <code class="docutils literal"><span class="pre">s%</span></code> for
unpacking the string length along with the string itself (#141).</li>
<li>Add length-aware string constructors <a class="reference internal" href="index.html#c.json_stringn" title="json_stringn"><code class="xref c c-func docutils literal"><span class="pre">json_stringn()</span></code></a> and
<a class="reference internal" href="index.html#c.json_stringn_nocheck" title="json_stringn_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_stringn_nocheck()</span></code></a>, length-aware string mutators
<a class="reference internal" href="index.html#c.json_string_setn" title="json_string_setn"><code class="xref c c-func docutils literal"><span class="pre">json_string_setn()</span></code></a> and <a class="reference internal" href="index.html#c.json_string_setn_nocheck" title="json_string_setn_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_string_setn_nocheck()</span></code></a>, and a
function for getting string&#8217;s length <a class="reference internal" href="index.html#c.json_string_length" title="json_string_length"><code class="xref c c-func docutils literal"><span class="pre">json_string_length()</span></code></a> (#141,
#143).</li>
<li>Support <code class="docutils literal"><span class="pre">\u0000</span></code> escapes in the decoder. The support can be
enabled by using the <code class="docutils literal"><span class="pre">JSON_ALLOW_NUL</span></code> decoding flag (#141).</li>
<li>Add <a class="reference internal" href="index.html#c.json_boolean_value" title="json_boolean_value"><code class="xref c c-func docutils literal"><span class="pre">json_boolean_value()</span></code></a> as an alias for <a class="reference internal" href="index.html#c.json_is_true" title="json_is_true"><code class="xref c c-func docutils literal"><span class="pre">json_is_true()</span></code></a>
(#146).</li>
<li>Add JSON_REAL_PRECISION encoding flag/macro for controlling real
number precision (#178).</li>
<li>Define the maximum indentation as JSON_MAX_INDENT (#191).</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Some malformed <code class="docutils literal"><span class="pre">\uNNNN</span></code> escapes could crash the decoder with an
assertion failure.</li>
<li>Avoid integer overflows with very long strings in UTF-8 decoder and
hashtable.</li>
<li>Check for <em>NULL</em> key in <a class="reference internal" href="index.html#c.json_object_get" title="json_object_get"><code class="xref c c-func docutils literal"><span class="pre">json_object_get()</span></code></a> and
<a class="reference internal" href="index.html#c.json_object_del" title="json_object_del"><code class="xref c c-func docutils literal"><span class="pre">json_object_del()</span></code></a> (#151).</li>
<li>Enhance hashtable seeding on Windows (#162).</li>
<li><a class="reference internal" href="index.html#c.json_unpack" title="json_unpack"><code class="xref c c-func docutils literal"><span class="pre">json_unpack()</span></code></a>: Allow mixing JSON_STRICT with optional keys
(#162, #163).</li>
<li>Fix int/int32 mismatch (#142).</li>
<li>Parse subnormal numbers correctly (#202).</li>
</ul>
</li>
<li>Build:<ul>
<li>Remove VS2010 build files. CMake should be used on Windows instead
(#165).</li>
<li>Fix CMake build flags for MinGW (#193).</li>
<li>Add CMake config files for find_package. Rename config.h to
jansson_private_config.h (#157, #159).</li>
<li>Make Valgrind checks work with CMake (#160).</li>
<li>Fix feature checks to use correct __ATOMIC flags.</li>
<li>Fix CMake checks for uint16_t and uint8_t support (#177).</li>
<li>Make Jansson build on SmartOS/Solaris (#171).</li>
<li>Work around a GCC bug on Solaris (#175).</li>
<li>Fix autoreconf on Debian (#182).</li>
<li>Don&#8217;t use GNU make specific export for global AM_CFLAGS (#203,
#204).</li>
<li>Fix building on Android using the supplied Android.mk (#166,
#174).</li>
<li>Android.mk: Add -DHAVE_STDINT_H to LOCAL_CFLAGS (#200).</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Document JANSSON_BUILD_SHARED_LIBS CMake option (#187).</li>
</ul>
</li>
<li>Tests:<ul>
<li>Close file handles correctly (#198).</li>
</ul>
</li>
<li>Other changes:<ul>
<li><code class="docutils literal"><span class="pre">\uNNNN</span></code> escapes are now encoded in upper case for better
readability.</li>
<li>Enable usage of AddressSanitizer (#180).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-6">
<h4>Version 2.6<a class="headerlink" href="#version-2-6" title="Permalink to this headline">¶</a></h4>
<p>Released 2014-02-11</p>
<ul class="simple">
<li>Security:<ul>
<li>CVE-2013-6401: The hash function used by the hashtable
implementation has been changed, and is automatically seeded with
random data when the first JSON object is created. This prevents
an attacker from causing large JSON objects with specially crafted
keys perform poorly.</li>
</ul>
</li>
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_object_seed" title="json_object_seed"><code class="xref c c-func docutils literal"><span class="pre">json_object_seed()</span></code></a>: Set the seed value of the hash function.</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Include CMake specific files in the release tarball.</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Fix tutorial source to send a User-Agent header, which is now
required by the GitHub API.</li>
<li>Set all memory to zero in secure_free() example.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-5">
<h4>Version 2.5<a class="headerlink" href="#version-2-5" title="Permalink to this headline">¶</a></h4>
<p>Released 2013-09-19</p>
<ul class="simple">
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a> and friends: Add format specifiers <code class="docutils literal"><span class="pre">s#</span></code>, <code class="docutils literal"><span class="pre">+</span></code> and
<code class="docutils literal"><span class="pre">+#</span></code>.</li>
<li>Add <code class="docutils literal"><span class="pre">JSON_DECODE_INT_AS_REAL</span></code> decoding flag to treat all numbers
as real in the decoder (#123).</li>
<li>Add <a class="reference internal" href="index.html#c.json_array_foreach" title="json_array_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_array_foreach()</span></code></a>, paralleling <a class="reference internal" href="index.html#c.json_object_foreach" title="json_object_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach()</span></code></a>
(#118).</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li><a class="reference internal" href="index.html#c.json_dumps" title="json_dumps"><code class="xref c c-func docutils literal"><span class="pre">json_dumps()</span></code></a> and friends: Don&#8217;t crash if json is <em>NULL</em> and
<code class="docutils literal"><span class="pre">JSON_ENCODE_ANY</span></code> is set.</li>
<li>Fix a theoretical integer overflow in <code class="xref c c-func docutils literal"><span class="pre">jsonp_strdup()</span></code>.</li>
<li>Fix <code class="xref c c-func docutils literal"><span class="pre">l_isxdigit()</span></code> macro (#97).</li>
<li>Fix an off-by-one error in <a class="reference internal" href="index.html#c.json_array_remove" title="json_array_remove"><code class="xref c c-func docutils literal"><span class="pre">json_array_remove()</span></code></a>.</li>
</ul>
</li>
<li>Build:<ul>
<li>Support CMake in addition to GNU Autotools (#106, #107, #112,
#115, #120, #127).</li>
<li>Support building for Android (#109).</li>
<li>Don&#8217;t use <code class="docutils literal"><span class="pre">-Werror</span></code> by default.</li>
<li>Support building and testing with VPATH (#93).</li>
<li>Fix compilation when <code class="docutils literal"><span class="pre">NDEBUG</span></code> is defined (#128)</li>
</ul>
</li>
<li>Tests:<ul>
<li>Fix a refleak in <code class="docutils literal"><span class="pre">test/bin/json_process.c</span></code>.</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Clarify the return value of <a class="reference internal" href="index.html#c.json_load_callback_t" title="json_load_callback_t"><code class="xref c c-func docutils literal"><span class="pre">json_load_callback_t()</span></code></a>.</li>
<li>Document how to circumvent problems with separate heaps on Windows.</li>
<li>Fix memory leaks and warnings in <code class="docutils literal"><span class="pre">github_commits.c</span></code>.</li>
<li>Use <a class="reference internal" href="index.html#c.json_decref" title="json_decref"><code class="xref c c-func docutils literal"><span class="pre">json_decref()</span></code></a> properly in tutorial.</li>
</ul>
</li>
<li>Other:<ul>
<li>Make it possible to forward declare <code class="docutils literal"><span class="pre">struct</span> <span class="pre">json_t</span></code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-4">
<h4>Version 2.4<a class="headerlink" href="#version-2-4" title="Permalink to this headline">¶</a></h4>
<p>Released 2012-09-23</p>
<ul class="simple">
<li>New features:<ul>
<li>Add <a class="reference internal" href="index.html#c.json_boolean" title="json_boolean"><code class="xref c c-func docutils literal"><span class="pre">json_boolean()</span></code></a> macro that returns the JSON true or false
value based on its argument (#86).</li>
<li>Add <a class="reference internal" href="index.html#c.json_load_callback" title="json_load_callback"><code class="xref c c-func docutils literal"><span class="pre">json_load_callback()</span></code></a> that calls a callback function
repeatedly to read the JSON input (#57).</li>
<li>Add JSON_ESCAPE_SLASH encoding flag to escape all occurences of
<code class="docutils literal"><span class="pre">/</span></code> with <code class="docutils literal"><span class="pre">\/</span></code>.</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Check for and reject NaN and Inf values for reals. Encoding these
values resulted in invalid JSON.</li>
<li>Fix <a class="reference internal" href="index.html#c.json_real_set" title="json_real_set"><code class="xref c c-func docutils literal"><span class="pre">json_real_set()</span></code></a> to return -1 on error.</li>
</ul>
</li>
<li>Build:<ul>
<li>Jansson now builds on Windows with Visual Studio 2010, and
includes solution and project files in <code class="docutils literal"><span class="pre">win32/vs2010/</span></code>
directory.</li>
<li>Fix build warnings (#77, #78).</li>
<li>Add <code class="docutils literal"><span class="pre">-no-undefined</span></code> to LDFLAGS (#90).</li>
</ul>
</li>
<li>Tests:<ul>
<li>Fix the symbol exports test on Linux/PPC64 (#88).</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Fix typos (#73, #84).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-3-1">
<h4>Version 2.3.1<a class="headerlink" href="#version-2-3-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2012-04-20</p>
<ul class="simple">
<li>Build issues:<ul>
<li>Only use <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> if <code class="docutils literal"><span class="pre">strtoll()</span></code> is also available.</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Fix the names of library version constants in documentation. (#52)</li>
<li>Change the tutorial to use GitHub API v3. (#65)</li>
</ul>
</li>
<li>Tests:<ul>
<li>Make some tests locale independent. (#51)</li>
<li>Distribute the library exports test in the tarball.</li>
<li>Make test run on shells that don&#8217;t support the <code class="docutils literal"><span class="pre">export</span> <span class="pre">FOO=bar</span></code>
syntax.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-3">
<h4>Version 2.3<a class="headerlink" href="#version-2-3" title="Permalink to this headline">¶</a></h4>
<p>Released 2012-01-27</p>
<ul class="simple">
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_unpack" title="json_unpack"><code class="xref c c-func docutils literal"><span class="pre">json_unpack()</span></code></a> and friends: Add support for optional object keys
with the <code class="docutils literal"><span class="pre">{s?o}</span></code> syntax.</li>
<li>Add <a class="reference internal" href="index.html#c.json_object_update_existing" title="json_object_update_existing"><code class="xref c c-func docutils literal"><span class="pre">json_object_update_existing()</span></code></a> and
<a class="reference internal" href="index.html#c.json_object_update_missing" title="json_object_update_missing"><code class="xref c c-func docutils literal"><span class="pre">json_object_update_missing()</span></code></a>, for updating only existing keys or
only adding missing keys to an object. (#37)</li>
<li>Add <a class="reference internal" href="index.html#c.json_object_foreach" title="json_object_foreach"><code class="xref c c-func docutils literal"><span class="pre">json_object_foreach()</span></code></a> for more convenient iteration over
objects. (#45, #46)</li>
<li>When decoding JSON, write the number of bytes that were read from
input to <code class="docutils literal"><span class="pre">error.position</span></code> also on success. This is handy with
<code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code>.</li>
<li>Add support for decoding any JSON value, not just arrays or
objects. The support is enabled with the new <code class="docutils literal"><span class="pre">JSON_DECODE_ANY</span></code>
flag. Patch by Andrea Marchesini. (#4)</li>
</ul>
</li>
<li>Bug fixes<ul>
<li>Avoid problems with object&#8217;s serial number growing too big. (#40,
#41)</li>
<li>Decoding functions now return NULL if the first argument is NULL.
Patch by Andrea Marchesini.</li>
<li>Include <code class="docutils literal"><span class="pre">jansson_config.h.win32</span></code> in the distribution tarball.</li>
<li>Remove <code class="docutils literal"><span class="pre">+</span></code> and leading zeros from exponents in the encoder.
(#39)</li>
<li>Make Jansson build and work on MinGW. (#39, #38)</li>
</ul>
</li>
<li>Documentation<ul>
<li>Note that the same JSON values must not be encoded in parallel by
separate threads. (#42)</li>
<li>Document MinGW support.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-2-1">
<h4>Version 2.2.1<a class="headerlink" href="#version-2-2-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2011-10-06</p>
<ul class="simple">
<li>Bug fixes:<ul>
<li>Fix real number encoding and decoding under non-C locales. (#32)</li>
<li>Fix identifier decoding under non-UTF-8 locales. (#35)</li>
<li><a class="reference internal" href="index.html#c.json_load_file" title="json_load_file"><code class="xref c c-func docutils literal"><span class="pre">json_load_file()</span></code></a>: Open the input file in binary mode for maximum
compatiblity.</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Clarify the lifecycle of the result of the <code class="docutils literal"><span class="pre">s</span></code> fromat of
<a class="reference internal" href="index.html#c.json_unpack" title="json_unpack"><code class="xref c c-func docutils literal"><span class="pre">json_unpack()</span></code></a>. (#31)</li>
<li>Add some portability info. (#36)</li>
<li>Little clarifications here and there.</li>
</ul>
</li>
<li>Other:<ul>
<li>Some style fixes, issues detected by static analyzers.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-2">
<h4>Version 2.2<a class="headerlink" href="#version-2-2" title="Permalink to this headline">¶</a></h4>
<p>Released 2011-09-03</p>
<ul class="simple">
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_dump_callback" title="json_dump_callback"><code class="xref c c-func docutils literal"><span class="pre">json_dump_callback()</span></code></a>: Pass the encoder output to a callback
function in chunks.</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li><a class="reference internal" href="index.html#c.json_string_set" title="json_string_set"><code class="xref c c-func docutils literal"><span class="pre">json_string_set()</span></code></a>: Check that target is a string and value is
not NULL.</li>
</ul>
</li>
<li>Other:<ul>
<li>Documentation typo fixes and clarifications.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-1">
<h4>Version 2.1<a class="headerlink" href="#version-2-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2011-06-10</p>
<ul class="simple">
<li>New features:<ul>
<li><a class="reference internal" href="index.html#c.json_loadb" title="json_loadb"><code class="xref c c-func docutils literal"><span class="pre">json_loadb()</span></code></a>: Decode a string with a given size, useful if the
string is not null terminated.</li>
<li>Add <code class="docutils literal"><span class="pre">JSON_ENCODE_ANY</span></code> encoding flag to allow encoding any JSON
value. By default, only arrays and objects can be encoded. (#19)</li>
<li>Add <code class="docutils literal"><span class="pre">JSON_REJECT_DUPLICATES</span></code> decoding flag to issue a decoding
error if any JSON object in the input contins duplicate keys. (#3)</li>
<li>Add <code class="docutils literal"><span class="pre">JSON_DISABLE_EOF_CHECK</span></code> decoding flag to stop decoding after a
valid JSON input. This allows other data after the JSON data.</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Fix an additional memory leak when memory allocation fails in
<a class="reference internal" href="index.html#c.json_object_set" title="json_object_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_set()</span></code></a> and friends.</li>
<li>Clear errno before calling <code class="xref c c-func docutils literal"><span class="pre">strtod()</span></code> for better portability. (#27)</li>
</ul>
</li>
<li>Building:<ul>
<li>Avoid set-but-not-used warning/error in a test. (#20)</li>
</ul>
</li>
<li>Other:<ul>
<li>Minor clarifications to documentation.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-0-1">
<h4>Version 2.0.1<a class="headerlink" href="#version-2-0-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2011-03-31</p>
<ul class="simple">
<li>Bug fixes:<ul>
<li>Replace a few <code class="xref c c-func docutils literal"><span class="pre">malloc()</span></code> and <code class="xref c c-func docutils literal"><span class="pre">free()</span></code> calls with their
counterparts that support custom memory management.</li>
<li>Fix object key hashing in json_unpack() strict checking mode.</li>
<li>Fix the parentheses in <code class="docutils literal"><span class="pre">JANSSON_VERSION_HEX</span></code> macro.</li>
<li>Fix <a class="reference internal" href="index.html#c.json_object_size" title="json_object_size"><code class="xref c c-func docutils literal"><span class="pre">json_object_size()</span></code></a> return value.</li>
<li>Fix a few compilation issues.</li>
</ul>
</li>
<li>Portability:<ul>
<li>Enhance portability of <code class="xref c c-func docutils literal"><span class="pre">va_copy()</span></code>.</li>
<li>Test framework portability enhancements.</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Distribute <code class="docutils literal"><span class="pre">doc/upgrading.rst</span></code> with the source tarball.</li>
<li>Build documentation in strict mode in <code class="docutils literal"><span class="pre">make</span> <span class="pre">distcheck</span></code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-0">
<h4>Version 2.0<a class="headerlink" href="#version-2-0" title="Permalink to this headline">¶</a></h4>
<p>Released 2011-02-28</p>
<p>This release is backwards incompatible with the 1.x release series.
See the chapter &#8220;Upgrading from older versions&#8221; in documentation for
details.</p>
<ul class="simple">
<li>Backwards incompatible changes:<ul>
<li>Unify unsigned integer usage in the API: All occurences of
unsigned int and unsigned long have been replaced with size_t.</li>
<li>Change JSON integer&#8217;s underlying type to the widest signed integer
type available, i.e. long long if it&#8217;s supported, otherwise long.
Add a typedef json_int_t that defines the type.</li>
<li>Change the maximum indentation depth to 31 spaces in encoder. This
frees up bits from the flags parameter of encoding functions
<a class="reference internal" href="index.html#c.json_dumpf" title="json_dumpf"><code class="xref c c-func docutils literal"><span class="pre">json_dumpf()</span></code></a>, <a class="reference internal" href="index.html#c.json_dumps" title="json_dumps"><code class="xref c c-func docutils literal"><span class="pre">json_dumps()</span></code></a> and <a class="reference internal" href="index.html#c.json_dump_file" title="json_dump_file"><code class="xref c c-func docutils literal"><span class="pre">json_dump_file()</span></code></a>.</li>
<li>For future needs, add a flags parameter to all decoding functions
<a class="reference internal" href="index.html#c.json_loadf" title="json_loadf"><code class="xref c c-func docutils literal"><span class="pre">json_loadf()</span></code></a>, <a class="reference internal" href="index.html#c.json_loads" title="json_loads"><code class="xref c c-func docutils literal"><span class="pre">json_loads()</span></code></a> and <a class="reference internal" href="index.html#c.json_load_file" title="json_load_file"><code class="xref c c-func docutils literal"><span class="pre">json_load_file()</span></code></a>.</li>
</ul>
</li>
<li>New features<ul>
<li><a class="reference internal" href="index.html#c.json_pack" title="json_pack"><code class="xref c c-func docutils literal"><span class="pre">json_pack()</span></code></a>, <a class="reference internal" href="index.html#c.json_pack_ex" title="json_pack_ex"><code class="xref c c-func docutils literal"><span class="pre">json_pack_ex()</span></code></a>, <a class="reference internal" href="index.html#c.json_vpack_ex" title="json_vpack_ex"><code class="xref c c-func docutils literal"><span class="pre">json_vpack_ex()</span></code></a>: Create JSON
values based on a format string.</li>
<li><a class="reference internal" href="index.html#c.json_unpack" title="json_unpack"><code class="xref c c-func docutils literal"><span class="pre">json_unpack()</span></code></a>, <a class="reference internal" href="index.html#c.json_unpack_ex" title="json_unpack_ex"><code class="xref c c-func docutils literal"><span class="pre">json_unpack_ex()</span></code></a>, <a class="reference internal" href="index.html#c.json_vunpack_ex" title="json_vunpack_ex"><code class="xref c c-func docutils literal"><span class="pre">json_vunpack_ex()</span></code></a>: Simple
value extraction and validation functionality based on a format
string.</li>
<li>Add column, position and source fields to the <code class="docutils literal"><span class="pre">json_error_t</span></code>
struct.</li>
<li>Enhance error reporting in the decoder.</li>
<li><code class="docutils literal"><span class="pre">JANSSON_VERSION</span></code> et al.: Preprocessor constants that define the
library version.</li>
<li><a class="reference internal" href="index.html#c.json_set_alloc_funcs" title="json_set_alloc_funcs"><code class="xref c c-func docutils literal"><span class="pre">json_set_alloc_funcs()</span></code></a>: Set custom memory allocation functions.</li>
</ul>
</li>
<li>Fix many portability issues, especially on Windows.</li>
<li>Configuration<ul>
<li>Add file <code class="docutils literal"><span class="pre">jansson_config.h</span></code> that contains site specific
configuration. It&#8217;s created automatically by the configure script,
or can be created by hand if the configure script cannot be used.
The file <code class="docutils literal"><span class="pre">jansson_config.h.win32</span></code> can be used without
modifications on Windows systems.</li>
<li>Add a section to documentation describing how to build Jansson on
Windows.</li>
<li>Documentation now requires Sphinx 1.0 or newer.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-1-3">
<h4>Version 1.3<a class="headerlink" href="#version-1-3" title="Permalink to this headline">¶</a></h4>
<p>Released 2010-06-13</p>
<ul class="simple">
<li>New functions:<ul>
<li><a class="reference internal" href="index.html#c.json_object_iter_set" title="json_object_iter_set"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_set()</span></code></a>, <a class="reference internal" href="index.html#c.json_object_iter_set_new" title="json_object_iter_set_new"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_set_new()</span></code></a>: Change
object contents while iterating over it.</li>
<li><a class="reference internal" href="index.html#c.json_object_iter_at" title="json_object_iter_at"><code class="xref c c-func docutils literal"><span class="pre">json_object_iter_at()</span></code></a>: Return an iterator that points to a
specific object item.</li>
</ul>
</li>
<li>New encoding flags:<ul>
<li><code class="docutils literal"><span class="pre">JSON_PRESERVE_ORDER</span></code>: Preserve the insertion order of object
keys.</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Fix an error that occured when an array or object was first
encoded as empty, then populated with some data, and then
re-encoded</li>
<li>Fix the situation like above, but when the first encoding resulted
in an error</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Clarify the documentation on reference stealing, providing an
example usage pattern</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-1-2-1">
<h4>Version 1.2.1<a class="headerlink" href="#version-1-2-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2010-04-03</p>
<ul class="simple">
<li>Bug fixes:<ul>
<li>Fix reference counting on <code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">false</span></code> and <code class="docutils literal"><span class="pre">null</span></code></li>
<li>Estimate real number underflows in decoder with 0.0 instead of
issuing an error</li>
</ul>
</li>
<li>Portability:<ul>
<li>Make <code class="docutils literal"><span class="pre">int32_t</span></code> available on all systems</li>
<li>Support compilers that don&#8217;t have the <code class="docutils literal"><span class="pre">inline</span></code> keyword</li>
<li>Require Autoconf 2.60 (for <code class="docutils literal"><span class="pre">int32_t</span></code>)</li>
</ul>
</li>
<li>Tests:<ul>
<li>Print test names correctly when <code class="docutils literal"><span class="pre">VERBOSE=1</span></code></li>
<li><code class="docutils literal"><span class="pre">test/suites/api</span></code>: Fail when a test fails</li>
<li>Enhance tests for iterators</li>
<li>Enhance tests for decoding texts that contain null bytes</li>
</ul>
</li>
<li>Documentation:<ul>
<li>Don&#8217;t remove <code class="docutils literal"><span class="pre">changes.rst</span></code> in <code class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></code></li>
<li>Add a chapter on RFC conformance</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-1-2">
<h4>Version 1.2<a class="headerlink" href="#version-1-2" title="Permalink to this headline">¶</a></h4>
<p>Released 2010-01-21</p>
<ul class="simple">
<li>New functions:<ul>
<li><a class="reference internal" href="index.html#c.json_equal" title="json_equal"><code class="xref c c-func docutils literal"><span class="pre">json_equal()</span></code></a>: Test whether two JSON values are equal</li>
<li><a class="reference internal" href="index.html#c.json_copy" title="json_copy"><code class="xref c c-func docutils literal"><span class="pre">json_copy()</span></code></a> and <a class="reference internal" href="index.html#c.json_deep_copy" title="json_deep_copy"><code class="xref c c-func docutils literal"><span class="pre">json_deep_copy()</span></code></a>: Make shallow and deep copies
of JSON values</li>
<li>Add a version of all functions taking a string argument that
doesn&#8217;t check for valid UTF-8: <a class="reference internal" href="index.html#c.json_string_nocheck" title="json_string_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_string_nocheck()</span></code></a>,
<a class="reference internal" href="index.html#c.json_string_set_nocheck" title="json_string_set_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_string_set_nocheck()</span></code></a>, <a class="reference internal" href="index.html#c.json_object_set_nocheck" title="json_object_set_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_object_set_nocheck()</span></code></a>,
<a class="reference internal" href="index.html#c.json_object_set_new_nocheck" title="json_object_set_new_nocheck"><code class="xref c c-func docutils literal"><span class="pre">json_object_set_new_nocheck()</span></code></a></li>
</ul>
</li>
<li>New encoding flags:<ul>
<li><code class="docutils literal"><span class="pre">JSON_SORT_KEYS</span></code>: Sort objects by key</li>
<li><code class="docutils literal"><span class="pre">JSON_ENSURE_ASCII</span></code>: Escape all non-ASCII Unicode characters</li>
<li><code class="docutils literal"><span class="pre">JSON_COMPACT</span></code>: Use a compact representation with all unneeded
whitespace stripped</li>
</ul>
</li>
<li>Bug fixes:<ul>
<li>Revise and unify whitespace usage in encoder: Add spaces between
array and object items, never append newline to output.</li>
<li>Remove const qualifier from the <code class="docutils literal"><span class="pre">json_t</span></code> parameter in
<a class="reference internal" href="index.html#c.json_string_set" title="json_string_set"><code class="xref c c-func docutils literal"><span class="pre">json_string_set()</span></code></a>, <a class="reference internal" href="index.html#c.json_integer_set" title="json_integer_set"><code class="xref c c-func docutils literal"><span class="pre">json_integer_set()</span></code></a> and <a class="reference internal" href="index.html#c.json_real_set" title="json_real_set"><code class="xref c c-func docutils literal"><span class="pre">json_real_set()</span></code></a>.</li>
<li>Use <code class="docutils literal"><span class="pre">int32_t</span></code> internally for representing Unicode code points
(int is not enough on all platforms)</li>
</ul>
</li>
<li>Other changes:<ul>
<li>Convert <code class="docutils literal"><span class="pre">CHANGES</span></code> (this file) to reStructured text and add it to
HTML documentation</li>
<li>The test system has been refactored. Python is no longer required
to run the tests.</li>
<li>Documentation can now be built by invoking <code class="docutils literal"><span class="pre">make</span> <span class="pre">html</span></code></li>
<li>Support for pkg-config</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-1-1-3">
<h4>Version 1.1.3<a class="headerlink" href="#version-1-1-3" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-12-18</p>
<ul class="simple">
<li>Encode reals correctly, so that first encoding and then decoding a
real always produces the same value</li>
<li>Don&#8217;t export private symbols in <code class="docutils literal"><span class="pre">libjansson.so</span></code></li>
</ul>
</div>
<div class="section" id="version-1-1-2">
<h4>Version 1.1.2<a class="headerlink" href="#version-1-1-2" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-11-08</p>
<ul class="simple">
<li>Fix a bug where an error message was not produced if the input file
could not be opened in <a class="reference internal" href="index.html#c.json_load_file" title="json_load_file"><code class="xref c c-func docutils literal"><span class="pre">json_load_file()</span></code></a></li>
<li>Fix an assertion failure in decoder caused by a minus sign without a
digit after it</li>
<li>Remove an unneeded include of <code class="docutils literal"><span class="pre">stdint.h</span></code> in <code class="docutils literal"><span class="pre">jansson.h</span></code></li>
</ul>
</div>
<div class="section" id="version-1-1-1">
<h4>Version 1.1.1<a class="headerlink" href="#version-1-1-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-10-26</p>
<ul class="simple">
<li>All documentation files were not distributed with v1.1; build
documentation in make distcheck to prevent this in the future</li>
<li>Fix v1.1 release date in <code class="docutils literal"><span class="pre">CHANGES</span></code></li>
</ul>
</div>
<div class="section" id="version-1-1">
<h4>Version 1.1<a class="headerlink" href="#version-1-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-10-20</p>
<ul class="simple">
<li>API additions and improvements:<ul>
<li>Extend array and object APIs</li>
<li>Add functions to modify integer, real and string values</li>
<li>Improve argument validation</li>
<li>Use unsigned int instead of <code class="docutils literal"><span class="pre">uint32_t</span></code> for encoding flags</li>
</ul>
</li>
<li>Enhance documentation<ul>
<li>Add getting started guide and tutorial</li>
<li>Fix some typos</li>
<li>General clarifications and cleanup</li>
</ul>
</li>
<li>Check for integer and real overflows and underflows in decoder</li>
<li>Make singleton values thread-safe (<code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">false</span></code> and <code class="docutils literal"><span class="pre">null</span></code>)</li>
<li>Enhance circular reference handling</li>
<li>Don&#8217;t define <code class="docutils literal"><span class="pre">-std=c99</span></code> in <code class="docutils literal"><span class="pre">AM_CFLAGS</span></code></li>
<li>Add C++ guards to <code class="docutils literal"><span class="pre">jansson.h</span></code></li>
<li>Minor performance and portability improvements</li>
<li>Expand test coverage</li>
</ul>
</div>
<div class="section" id="version-1-0-4">
<h4>Version 1.0.4<a class="headerlink" href="#version-1-0-4" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-10-11</p>
<ul class="simple">
<li>Relax Autoconf version requirement to 2.59</li>
<li>Make Jansson compile on platforms where plain <code class="docutils literal"><span class="pre">char</span></code> is unsigned</li>
<li>Fix API tests for object</li>
</ul>
</div>
<div class="section" id="version-1-0-3">
<h4>Version 1.0.3<a class="headerlink" href="#version-1-0-3" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-09-14</p>
<ul class="simple">
<li>Check for integer and real overflows and underflows in decoder</li>
<li>Use the Python json module for tests, or simplejson if the json
module is not found</li>
<li>Distribute changelog (this file)</li>
</ul>
</div>
<div class="section" id="version-1-0-2">
<h4>Version 1.0.2<a class="headerlink" href="#version-1-0-2" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-09-08</p>
<ul class="simple">
<li>Handle EOF correctly in decoder</li>
</ul>
</div>
<div class="section" id="version-1-0-1">
<h4>Version 1.0.1<a class="headerlink" href="#version-1-0-1" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-09-04</p>
<ul class="simple">
<li>Fixed broken <a class="reference internal" href="index.html#c.json_is_boolean" title="json_is_boolean"><code class="xref c c-func docutils literal"><span class="pre">json_is_boolean()</span></code></a></li>
</ul>
</div>
<div class="section" id="version-1-0">
<h4>Version 1.0<a class="headerlink" href="#version-1-0" title="Permalink to this headline">¶</a></h4>
<p>Released 2009-08-25</p>
<ul class="simple">
<li>Initial release</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and Tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span>Index</span></a></li>
<li><a class="reference internal" href="search.html"><span>Search Page</span></a></li>
</ul>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2016, Petri Lehtinen.
      
        <span class="commit">
          Revision <code>08cb7b6d</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 2.9
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/2.9/">2.9</a></dd>
        
          <dd><a href="/en/2.8/">2.8</a></dd>
        
          <dd><a href="/en/2.7/">2.7</a></dd>
        
          <dd><a href="/en/2.6/">2.6</a></dd>
        
          <dd><a href="/en/2.5/">2.5</a></dd>
        
          <dd><a href="/en/2.4/">2.4</a></dd>
        
          <dd><a href="/en/2.3/">2.3</a></dd>
        
          <dd><a href="/en/2.2/">2.2</a></dd>
        
          <dd><a href="/en/2.1/">2.1</a></dd>
        
          <dd><a href="/en/2.0/">2.0</a></dd>
        
          <dd><a href="/en/1.3/">1.3</a></dd>
        
          <dd><a href="/en/1.2/">1.2</a></dd>
        
          <dd><a href="/en/1.1/">1.1</a></dd>
        
          <dd><a href="/en/1.0/">1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/jansson/downloads/pdf/2.9/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/jansson/downloads/htmlzip/2.9/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/jansson/downloads/epub/2.9/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/jansson/?fromdocs=jansson">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/jansson/?fromdocs=jansson">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>